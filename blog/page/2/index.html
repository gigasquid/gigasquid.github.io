
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Squid's Blog</title>
    <meta name="author" content="Carin Meier">
    
	<meta name="description" content="Published on: Jan 16th, 2016 Tags: All This 21st century illustrated manuscript was recently uncovered. It depicts miraculous phenomena in software &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Squid's Blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='http://fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <script src="/javascripts/ajaxify.js"></script>
   
    
    

</head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated">
    <div id="headerbg">
        Squid's Blog
    </div>
</h1>
<br>

<ul id="social-links" style="text-align:center">
  
  
  
  
  
  
  
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/about/index.html">About</a></li>
	<li id="ajax"><a href="/speaking/index.html">Speaking</a></li>
	<li id="ajax"><a href="/books/index.html">Books</a></li>
	<li id="ajax"><a href="/blog/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
</ul>




</header>

<div id="toload">
<!-- begin toload --> 
    <div id="content" class="inner">
        


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/01/16/book-of-software-miracles/">
		
			Book of Software Miracles</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2016-01-16T22:09:00-05:00" pubdate data-updated="true">Jan 16<span>th</span>, 2016</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>


</div>
    </div>
		<p><img src="http://c2.staticflickr.com/2/1611/23811303563_029d4c864e_c.jpg" title="&#34;Book of Software Miracles - Cover&#34;" alt="&#34;Book of Software Miracles - Cover&#34;"></p>

<p>This 21st century illustrated manuscript was recently uncovered.  It depicts miraculous phenomena in software engineering and represents one of the most spectacular new discoveries in the field of Renaissance Computer Science.</p>

<p>Some examples of the glorious illustrations and text translations are presented here.</p>

<p><img src="http://c2.staticflickr.com/2/1520/24070311299_c23fc388e0_z.jpg" title="&#34;Book of Software Miracles Fol. 26&#34;" alt="&#34;Book of Software Miracles Fol. 26&#34;"></p>

<p><em>On the day in 1958 that John McCarthy invented LISP, three suns appeared in the East in the morning sky which moved towards each other so that they merged into one.</em></p>

<p><img src="http://c2.staticflickr.com/2/1448/24355655351_f449746e80_z.jpg" title="&#34;Book of Software Miracles Fol. 72&#34;" alt="&#34;Book of Software Miracles Fol. 72&#34;"></p>

<p><em>In the year 1952, countless software bugs appeared in the land after being coined by Grace Hopper during the invention of the COBOL language.</em></p>

<p><img src="http://c2.staticflickr.com/2/1644/23809895144_dac1fdcc2c_z.jpg" title="&#34;Book of Software Miracles Fol. 83&#34;" alt="&#34;Book of Software Miracles Fol. 83&#34;"></p>

<p><em>In the year of 2007, a great and wonderful comet appeared in the sky.  This was followed by the invention of the Clojure language by Rich Hickey.</em></p>

<p><img src="http://c2.staticflickr.com/2/1704/24070310299_c9b80e4033_z.jpg" title="&#34;Book of Software Miracles Fol. 91&#34;" alt="&#34;Book of Software Miracles Fol. 91&#34;"></p>

<p><em>A month after the NPM Node repository burst its banks in the year of 2015, a wondrous creature appeared from the JavaScript ecosystem.  Found dead after the raging subsided, was in this shape and form and is painted here.</em></p>

<p>For more information about this remarkable book visit <a href="http://www.taschen.com/pages/en/catalogue/classics/all/03107/facts.the_book_of_miracles.htm">Book of Software Miracles</a></p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2016/01/16/book-of-software-miracles//blog/page/2/index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/12/20/can-a-programming-language-make-you-smarter/">
		
			Can a Programming Language Make You Smarter?</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2015-12-20T11:16:00-05:00" pubdate data-updated="true">Dec 20<span>th</span>, 2015</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>


</div>
    </div>
		<p><img src="http://c1.staticflickr.com/1/34/118425909_86f332f075_z.jpg?zz=1"></p>

<p>All programming languages are not created equal.  Some clearly excel at solving different problems.  There are languages that are great for scalability and others that are great for proving correctness.  But what about one that that will make you smarter?  To look for this answer, I am going to turn to a different language, our human language, and research from the field of linguistics and cognitive development.</p>

<h3>A new language is born</h3>

<p>Up until the late 1970s, there was no school for the deaf In Nicaragua.  Being deaf before then meant only developing crude signs with your family and friends.  Beyond that there was nothing.  Finally, the wife of the dictator set up a special school for them.  This was the first time that the children were brought together in one place rather than being scattered about.  For most of them, it was the first time that they had ever met another deaf person.  There were about fifty kids in that first class and they came together with fifty different ways of communication with crude gestures.  But after awhile, something amazing happened. They started to converge into a common system &ndash; a language was born. For scientists, this was an incredible opportunity to watch a new language develop.  One of the fascinating insights had to do with how the this sign language evolved over the generations of children entering the school.  One in particular, was a study about how words in a language can actually increase your cognitive capacity and make people <em>smarter</em>.</p>

<p>The study involved a test that was performed on different generations of students from the school, including the very first students who were now grown and younger children.  A comic strip shown to the participants. In it there are two brothers.  The big brother is playing with the train and the little brother wants the play with it.  The big brother puts it under the bed and goes out to the kitchen to get a sandwich.  While the big brother is gone, the little brother takes out the train and hides it in the toy box.  The question for the test subjects is, &ldquo;When the big brother comes back, where is he going to look for the train?&rdquo;</p>

<h3>Thinking about thinking</h3>

<p>For most kids over the age of five, the answer will be that the big brother will look under the bed because he doesn&rsquo;t know that it has been moved to the toy box.  The interesting thing was that the first generation of kids that went through the school, now thirty five years old, failed this simple test.  The younger ones all passed.  What was going on?</p>

<p>To find out, the scientists looked a differences in the language over the generations and found that the older signers lacked words for the concept of thinking.  The earlier generation just had one word for <em>think</em>, while the later generations had evolved ten or twelve.  Words that expressed concepts like <em>understand</em> and <em>believe</em>.  It seems that having words gave them access to a concept that otherwise would have been really hard to think about.  It increased their cognitive capacity.  It enabled them to <em>think about thinking</em>.</p>

<h3>Thinking about programming programs</h3>

<p>Programming languages allow us to translate our human thoughts and instructions to machines.  We have words to express simple concepts like adding two numbers together with <code>+</code> or finding how many elements are in a list with <code>count</code>, but what about harder concepts that are more difficult to access?  Is there an analogy to having words to <em>think about thinking</em> that some programming languages have that others don&rsquo;t?  I believe there is.  It&rsquo;s having a way to think about a <em>program programming itself</em> with self modifying code or <em>macros</em>.</p>

<p>In Clojure, macros are way to do <em>meta-programming</em>.  This involves ability to treat the program as data, allowing a program to modify another program &ndash; even its own.  It gives Clojure the capability to implement language features, make code more concise, and encapsulate patterns and repetitive code.  It is a powerful feature and more to the point of our current line of inquiry, it is a pretty friggin difficult concept to grok.  In fact, before I was exposed to a language that had macros in it, I doubt that I would have been able to think about it.  For the sake of argument, let&rsquo;s go back to the comic strip story with the two brothers.  But this time, the train is a function and the little brother uses a macro on it when the big brother gets a snack in the kitchen.  What does the big brother expect the result of the program to be when he gets back in the room.  Prior to my exposure to Clojure and macros, I am sure I would have failed the test.</p>

<h3>Conclusion</h3>

<p>So yes, I do think that a programming language can increase your cognitive capacity and make you smarter.  I certainly feel that my exposure had expanded my world and given me access to programming concepts that I did not have with my other programming experience.  I also feel certain that there are other languages out there, both existing and yet to be invented, that have words to express concepts that am not even aware of.  Languages that are just waiting for me to expand my horizons.</p>

<p>And that certainty makes me incredibly happy and grateful to be a programmer.</p>

<p><em>Listen to whole fascinating story of Ann Senghas studying sign language that born in Nicaragua on <a href="http://www.radiolab.org/story/91730-new-words-new-world/">Radiolab</a></em></p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2015/12/20/can-a-programming-language-make-you-smarter//blog/page/2/index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/12/19/the-key-to-moving-fast-is-feedback/">
		
			The Key to Moving Fast Is Feedback</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2015-12-19T14:06:00-05:00" pubdate data-updated="true">Dec 19<span>th</span>, 2015</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>


</div>
    </div>
		<p><img src="http://c1.staticflickr.com/3/2205/1809288965_c84080f2d3_n.jpg"></p>

<p>The last time I went to the dentist to get a cavity filled, I got a shot of Novocain as a local anesthetic to numb the area.  After I emerged from the dental chair, I still had no feeling in my lip and mouth area.
Trying to talk and smile was comical.  Trying to drink tea resulting in dribbles down my face.  Luckily, the loss of feeling only lasted a couple hours.  Soon, I was back to normal.  Even in this small and common scenario, we can see the close link between motion and sensory perception.  What would happen if you couldn&rsquo;t feel your whole body?</p>

<p>This is exactly what happened in the tragic and amazing story of <a href="http://docuwiki.net/index.php?title=The_Man_who_Lost_his_Body">Ian Watermann</a>.  At age 19, he had what appeared to be the flu, but was actually a rare disease of the nervous system that left him unable to feel any sensation of touch below the neck.  Unable to process this sensory information, he was totally unable to walk or move his body.  This is despite the fact that his motor system was left almost untouched by the disease.  He had the capacity to move, but without the sensory feedback he was paralyzed.</p>

<p>Ian was told that he would spend the rest of his life in a wheelchair, but in an inspiring show of determination he recovered mobility.  With the help of physiotherapists, he retrained his brain to substitute visual feedback for touch feedback.  He could move his hands and legs while he could see them.  Finally, he could walk again with his sight and concentration.  If the visual feedback is taken away, (lights turned off), the ability to move vanishes.</p>

<p>Feedback is the essential ingredient for human motion.  But what about businesses, startups, and software projects?  One of the challenges that all of these face is the ability to <em>move</em> fast.  This ability to move is not unlike that in our own bodies.  Movement and action are a result of a complex, interdependent system.  In the case of businesses, they are made of people, technology, and processes.  Like the human body, it is critically dependent on feedback.   A business can have the capacity for action, but without the ability to process feedback it is essentially immobilized.</p>

<p>If you want to move fast, single most important thing you can do is to improve your feedback at every level.</p>

<p>If you want to add new technology, ask how it improves your feedback.</p>

<ul>
<li>Feedback from the market</li>
<li>Feedback from your users</li>
<li>Feedback from your operational systems</li>
<li>Feedback from your code</li>
<li>Feedback from your employees</li>
<li>Feedback from yourself</li>
</ul>


<p>The best feedback systems are distributed and multi-layered. A single market feedback signal to the CEO is good, but much better is one that gets shared among the many facets of a company.  A distributed and interconnected network of feedback will help companies and projects be responsive, fast, nimble, and resilient.</p>

<p>The next time you hear, &ldquo;How can we go faster&rdquo;?&ldquo; ask the question &#8220;How can we increase feedback?&rdquo;  You&rsquo;ll be on the right track to fly.</p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2015/12/19/the-key-to-moving-fast-is-feedback//blog/page/2/index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/12/08/gigasquids-radar-2015/">
		
			Gigasquid&#8217;s Radar 2015</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2015-12-08T17:36:00-05:00" pubdate data-updated="true">Dec 8<span>th</span>, 2015</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>


</div>
    </div>
		<p><img src="http://c1.staticflickr.com/1/627/23249736219_dfa625309b_c.jpg"></p>

<p>It&rsquo;s that time of the year again for <em>radars</em>.  Since I made <a href="http://gigasquidsoftware.com/blog/2014/12/17/gigasquids-radar-2014/">one last year</a>, I decided to continue the tradition and make one this year.</p>

<h2>Languages</h2>

<p>No changes from last year for Clojure and Pixie.</p>

<ul>
<li><em>Adopt</em>: Clojure &ndash; It is fantastic language.</li>
<li><em>Trial</em>: <a href="https://github.com/pixie-lang/pixie">Pixie</a> &ndash; The language continues to grow and improve and has a great community &ndash; and it is a LISP.</li>
<li><em>Assess</em>: <a href="http://elixir-lang.org/">Elixir</a> &ndash; Another great functional language leveraging the Erlang VM.   It has a lot of energy in the community.</li>
<li><em>Hold</em>: Java &ndash; There are plenty of other great alternatives out there on the JVM.</li>
</ul>


<h2>Cute Animals</h2>

<p>Alpacas have moved up from <em>trial</em> last year, and Llamas to <em>hold</em>.  Alpacas are clearly more fluffy.</p>

<ul>
<li><em>Adopt</em>: <a href="http://www.preciousanimals.com/wp-content/plugins/woo-tumblog/functions/thumb.php?src=wp-content/uploads/2012/03/Cute-Animals-4e41e26ba45d7.jpg&amp;w=530&amp;h=&amp;zc=1&amp;q=90">Alpacas</a> &ndash; Like llamas only fluffier.</li>
<li><em>Trial</em>: <a href="http://www.animalfactguide.com/wp-content/uploads/2013/08/quokka1.jpg">Quokkas</a> &ndash; Where does Australia get this <a href="https://en.wikipedia.org/wiki/Quokka">cutie</a>?</li>
<li><em>Assess</em>: <a href="http://apod.nasa.gov/apod/image/1303/tardigrade_eyeofscience_1024.jpg">Tardigrades &ndash; or Water Bear</a> &ndash; They are the cutest microscopic creature out there.</li>
<li><em>Hold</em>: <a href="http://www.llamas.org/imgs/corner.jpg">Llamas</a> &ndash; Not as fluffy as they could be.</li>
</ul>


<h2>Artificial Intelligence</h2>

<p>I haven&rsquo;t been too into robots this year, so the category has been changed to AI.</p>

<ul>
<li><em>Adopt</em>: <a href="http://www.cs.waikato.ac.nz/~ml/weka/">Weka</a> &ndash; A collection of machine learning algorithms and explorers.  I was very impressed with it when I tried it on a <a href="http://gigasquidsoftware.com/blog/2015/10/20/speech-act-classification-for-text-with-clojure/">speech acts classifier project</a>.</li>
<li><em>Trial</em>: <a href="http://deeplearning4j.org/word2vec.html">Word Vectors</a> &ndash; A way to encode words and leverage training so that you can see the relation between them.  For example, a dog is closer to the word wolf than cat.</li>
<li><em>Assess</em>: <a href="https://www.tensorflow.org/">Tensor Flow</a> &ndash; I have only scratched the surface with this, but it is an exciting open source computational pipeline for machine learning (and other things).  The tutorials are pretty amazing in quality alone.</li>
<li><em>Hold</em>: <a href="https://en.wikipedia.org/wiki/Inference#Automatic_logical_inference">Logical Inference</a> &ndash; This is pretty bold, but I base it on Professor Geoff Hinton&rsquo;s Deep Learning <a href="https://www.youtube.com/watch?v=IcOMKXAw5VA&amp;feature=youtu.be">talk</a> (at 33:00)  where he explains that thought vectors, (made from word vectors), will be able to perform natural reasoning with only linear algebra.  The grand dream of old fashioned strong AI, will then be realized in a completely different way.</li>
</ul>


<h2>Tasty Food</h2>

<ul>
<li><em>Adopt</em>: <a href="http://www.murrayscheese.com/media/catalog/product/cache/1/image/9df78eab33525d08d6e5fb8d27136e95/b/l/blue_stilton_colston_bassett.jpg">Stilton Cheese</a> &ndash; The king of cheeses.</li>
<li><em>Trial</em>: <a href="http://www.seriouseats.com/images/20100603-nibs-500.jpg">Cocoa Nibs</a> &ndash;  I have to admit I am getting into crunching on some nibs in the afternoon.  Best of all, no sugar!</li>
<li><em>Assess</em>: <a href="http://www.ahisushi.com/images/gallery/gallery-cold-sake.jpg">Cold Sake</a> &ndash; I was firmly in the warm sake camp, until I tried some very nice cold sakes.  However, in the winter, warm is so nice &hellip;</li>
<li><em>Hold</em>: <a href="https://cbshouston.files.wordpress.com/2012/12/fruitcake9.jpg?w=360">Fruit Cake</a> &ndash; Traditions are important, but sometimes you need to let it go.</li>
</ul>


<h3>Special Thanks</h3>

<p>The radar this year was generated by a cool <a href="https://github.com/thefourhorsemen/radar">github project</a> that uses Clojure and Quill to generate the image based off of a json config file.  So go out there and make a radar of your own.</p>

<p>Happy Holidays!</p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2015/12/08/gigasquids-radar-2015//blog/page/2/index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/10/20/speech-act-classification-for-text-with-clojure/">
		
			Speech Act Classification for Text With Clojure</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2015-10-20T13:11:00-04:00" pubdate data-updated="true">Oct 20<span>th</span>, 2015</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>, <a class='category' href='/blog/categories/clojure/'>Clojure</a>


</div>
    </div>
		<p>We humans are quite wonderful.  We do amazing things every day without even realizing it.  One of them, you are doing right now.  You are reading text.  Your brain is taking these jumbles of letters and spaces in this sentence, which in linguist terms is called an <a href="https://en.wikipedia.org/wiki/Utterance">utterance</a>, and making sense out of it.  The individual meanings of sentences might be quite complex.</p>

<p>Take for example the utterance, &ldquo;I like cheese&rdquo;.  To understand it properly, you need to know the meanings of the individual words.  In particular, you would need to know that cheese is a tasty food stuff that is made from milk.  This would be a detailed and full understanding.  But there is a higher level of understanding that we can look at called <a href="https://en.wikipedia.org/wiki/Utterance">Speech Acts</a>.</p>

<p>Speech Acts are way of classifying our communication according to purposes.  We perform speech acts when we ask questions, make statements, requests, promises, or even just say thanks.  These speech acts cross languages.  When I ask a question in English, it is the same speech act as if I ask it in French.  In fact, if we were to travel to another planet with aliens, we can assume if they had a language, it would involve speech acts.  It should be no surprise then, to communicate effectively with machines, it will have to understand speech acts.</p>

<p>To explore this communication we are going to consider only three speech acts:</p>

<ul>
<li>Statements &ndash; &ldquo;I like cheese.&rdquo;</li>
<li>Questions &ndash; &ldquo;How do you make cheese?&rdquo;</li>
<li>Expressives &ndash; &ldquo;Thank you&rdquo;</li>
</ul>


<p><em>Our goal is to have our program be able to tell the difference between these three speech acts &ndash; without punctuation.</em></p>

<p>Why not use punctuation?  If you are having a conversation with a human over Slack or some other chat channel, you may or may not put in a question mark or period.  To have a computer be able to converse as naturally with a human as another human, it will have to understand the speech act without the aid of punctuation.</p>

<p>Generally, we want to have the computer:</p>

<ol>
<li>Read in an utterance/text that may or may not have punctuation.</li>
<li>Classify whether the result is a statement, question, or expressive.</li>
</ol>


<p>To tackle this problem, we are going to have to break this up into two main parts.  The first is <em>parsing</em> the text and annotating it with data.  The second is to classify the text based on the data from the parsing.</p>

<h2>Parsing and Annotating Text with Stanford CoreNLP</h2>

<p>The <a href="http://nlp.stanford.edu/software/corenlp.shtml">Stanford CoreNLP</a> is considering the state of the art for POS, (Part of Speech), tagging and other linguistic annotations.  It also is a Java library, so very easy to use from Clojure.</p>

<p>Here we are using a simple wrapper library called <a href="https://github.com/gigasquid/stanford-talk">stanford-talk</a> to take in some text and process it.  The result is a list of <em>tokens</em> for each word in the <code>:token-data</code> map.  Each token is annotated with the POS tag.  There is a lot more data in the annotations that we can look at to give us insight into this text.  But, to keep things simple, we are just going to look at the POS speech tag at the moment.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">process-text</span> <span class="s">&quot;I like cheese&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;{:token-data</span>
</span><span class='line'><span class="c1">; ({:sent-num 0, :token &quot;I&quot;, :pos &quot;PRP&quot;, :net &quot;O&quot;, :lemma &quot;I&quot;, :sentiment &quot;Neutral&quot;}</span>
</span><span class='line'><span class="c1">;  {:sent-num 0, :token &quot;like&quot;, :pos &quot;VBP&quot;, :net &quot;O&quot;, :lemma &quot;like&quot;, :sentiment &quot;Neutral&quot;}</span>
</span><span class='line'><span class="c1">;  {:sent-num 0, :token &quot;cheese&quot;, :pos &quot;NN&quot;, :net &quot;O&quot;, :lemma &quot;cheese&quot;, :sentiment &quot;Neutral&quot;}),</span>
</span><span class='line'><span class="c1">; :refs [[{:sent-num 0, :token &quot;I&quot;, :gender &quot;UNKNOWN&quot;, :mention-type &quot;PRONOMINAL&quot;, :number &quot;SINGULAR&quot;, :animacy &quot;ANIMATE&quot;};]]}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So the text &ldquo;I like cheese&rdquo; has the following POS tags <a href="https://www.ling.upenn.edu/courses/Fall_2003/ling001/penn_treebank_pos.html">list of all POS tags</a>:</p>

<ul>
<li>I = PRP Personal Pronoun</li>
<li>like = VBP Verb, non-3rd person singular present</li>
<li>cheese &ndash; Noun, singular or mass</li>
</ul>


<p>This is great.  We have some data about the text we can analyze.  The next thing to do is to figure out how to classify the text based on this data.</p>

<h2>Classification with Weka</h2>

<p><a href="http://www.cs.waikato.ac.nz/~ml/weka/">Weka</a> is a collection of machine learning algorithms.  There is a program for interactive exploration of data sets, as well as a java library so you can use it programatically.  Speaking of data sets, we need some.  Just having one sentence about liking cheese is not going to get us very far with any machine learning.</p>

<p>So where can you go to get conversational questions and statements on the internet?  Well, one place that is pretty good for that is <a href="http://www.answers.com/Q/FAQ/2528-9">answers.com</a>.  We can scrape some pages for questions and answers.  Enough so that we can collect and cleanup some input files of</p>

<ul>
<li>~ 200 statements</li>
<li>~ 200 questions</li>
</ul>


<p>The expressives were a bit more difficult.  Let&rsquo;s just make a list of about 80 of them.</p>

<p>Now, we have a list of text data.  We need to decide on some features and generate some input files to train the classifiers on.</p>

<h3>Choosing Features for Classification</h3>

<p>First, what is a feature?  A feature is some sort of encoding of the data that the computer is going to consider for classification. For example, the number of nouns in a sentence could be a feature.  There is a whole field of study dedicated to figuring out what the best features for data for machine learning are.  Again, to keep things simple, we can take an educated guess on some features based on a good <a href="https://www.cs.utah.edu/~riloff/pdfs/emnlp11-speechacts.pdf">paper</a>:</p>

<ul>
<li>Sentence length</li>
<li>Number of nouns in the sentence (NN, NNS, NNP, NNPS)</li>
<li>If the sentence ends in a noun or adjective (NN, NNS, NNP, NNPS, JJ, JJR, JJS)</li>
<li>If the sentence begins in a verb (VB, VBD, VBG, VBP, VPZ)</li>
<li>The count of the wh, (like who, what) markers (WDT, WRB, WP, WP$)</li>
</ul>


<p>We can now go through our data file, generate our feature data, and output .arff file format to ready it as training file for weka.</p>

<p>Raw question file example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">What</span> <span class="nv">is</span> <span class="nv">floater</span> <span class="nv">exe</span>
</span><span class='line'><span class="nv">Is</span> <span class="nv">bottled</span> <span class="nv">water</span> <span class="nb">or </span><span class="nv">tap</span> <span class="nv">water</span> <span class="nv">better</span> <span class="nb">for </span><span class="nv">your</span> <span class="nv">dog</span>
</span><span class='line'><span class="nv">How</span> <span class="k">do </span><span class="nv">you</span> <span class="nv">treat</span> <span class="nv">lie</span> <span class="nv">bumps</span> <span class="nv">on</span> <span class="nv">the</span> <span class="nv">tongue</span>
</span><span class='line'><span class="nv">Can</span> <span class="nv">caffeine</span> <span class="nv">be</span> <span class="nv">used</span> <span class="nv">in</span> <span class="nv">powder</span> <span class="nv">form</span>
</span></code></pre></td></tr></table></div></figure>


<p>Arff file with features</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="err">@</span><span class="nv">relation</span> <span class="nv">speechacts</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="nv">attribute</span>       <span class="nv">sen_len</span>            <span class="nv">numeric</span>
</span><span class='line'><span class="err">@</span><span class="nv">attribute</span>       <span class="nv">nn_num</span>             <span class="nv">numeric</span>
</span><span class='line'><span class="err">@</span><span class="nv">attribute</span>       <span class="nv">end_in_n</span>           <span class="nv">numeric</span>
</span><span class='line'><span class="err">@</span><span class="nv">attribute</span>       <span class="nv">begin_v</span>            <span class="nv">numeric</span>
</span><span class='line'><span class="err">@</span><span class="nv">attribute</span>       <span class="nv">wh_num</span>             <span class="nv">numeric</span>
</span><span class='line'><span class="err">@</span><span class="nv">attribute</span>       <span class="nv">type</span>               <span class="p">{</span><span class="nv">assertion</span>,<span class="nv">question</span>,<span class="nv">expressive</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="nv">data</span>
</span><span class='line'><span class="mi">4</span>,<span class="mi">2</span>,<span class="mi">1</span>,<span class="mi">0</span>,<span class="mi">1</span>,<span class="nv">question</span>
</span><span class='line'><span class="mi">10</span>,<span class="mi">4</span>,<span class="mi">1</span>,<span class="mi">0</span>,<span class="mi">0</span>,<span class="nv">question</span>
</span><span class='line'><span class="mi">9</span>,<span class="mi">3</span>,<span class="mi">1</span>,<span class="mi">0</span>,<span class="mi">1</span>,<span class="nv">question</span>
</span><span class='line'><span class="mi">7</span>,<span class="mi">3</span>,<span class="mi">1</span>,<span class="mi">0</span>,<span class="mi">0</span>,<span class="nv">question</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that we have our input file to training our machine learning algorithms, we can start looking at classifiers.</p>

<h3>Choosing the Classifier</h3>

<p><img src="http://c2.staticflickr.com/6/5794/22338401315_1abf0ffb2d_z.jpg"></p>

<p>Using the weka explorer, we can try out different classification models.  For this data, the best one seems to be the <a href="https://en.wikipedia.org/wiki/Random_forest">Random Forest</a>.  In the explorer, it beat out Naive Bayes and J48.  It is also worth mentioning that we are not using a separate source of test data, we are cross validating on the original training set.  If we wanted to be more rigorous, we could collect more data and cut it in half, using one set for the training and one set for the testing.</p>

<p>Now that we have a classifier, we can create some Clojure code with the java library to use it.</p>

<h3>Using the Weka Classifier from our Clojure Code</h3>

<p>After importing the needed Java classes into our Clojure code, we can create the Random Forest classifier.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">classifier</span> <span class="p">(</span><span class="k">new </span><span class="nv">RandomForest</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We then create a function that will load our arff input file as a datasource</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">get-datasource</span> <span class="p">[</span><span class="nv">fname</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">new </span><span class="nv">ConverterUtils$DataSource</span>
</span><span class='line'>       <span class="p">(</span><span class="nf">.getResourceAsStream</span> <span class="p">(</span><span class="nf">clojure.lang.RT/baseLoader</span><span class="p">)</span> <span class="nv">fname</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>And another uses it to train the classifier, returning a map of the <em>evaluator</em> and <em>data</em> that we will need for our predictions.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">train-classifier</span> <span class="p">[</span><span class="nv">fname</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">source</span> <span class="p">(</span><span class="nf">get-datasource</span> <span class="nv">fname</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">data</span> <span class="p">(</span><span class="nf">.getDataSet</span> <span class="nv">source</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">_</span> <span class="p">(</span><span class="nf">.setClassIndex</span> <span class="nv">data</span> <span class="p">(</span><span class="nb">dec </span><span class="p">(</span><span class="nf">.numAttributes</span> <span class="nv">data</span><span class="p">)))</span>
</span><span class='line'>        <span class="nv">_</span>  <span class="p">(</span><span class="nf">.buildClassifier</span> <span class="nv">classifier</span> <span class="nv">data</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">e</span> <span class="p">(</span><span class="k">new </span><span class="nv">Evaluation</span> <span class="nv">data</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">.crossValidateModel</span> <span class="nv">e</span> <span class="nv">classifier</span> <span class="nv">data</span> <span class="p">(</span><span class="nf">.intValue</span> <span class="p">(</span><span class="nb">int </span><span class="mi">10</span><span class="p">))</span> <span class="p">(</span><span class="k">new </span><span class="nv">Random</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">into-array </span><span class="p">[]))</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nf">.toSummaryString</span> <span class="nv">e</span><span class="p">))</span>
</span><span class='line'>    <span class="p">{</span><span class="ss">:evaluator</span> <span class="nv">e</span>
</span><span class='line'>     <span class="ss">:data</span> <span class="nv">data</span><span class="p">}))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, we need to be able to ask about a classification for a particular instance of new data.  This is going to be where we are parsing new text and asking for an answer from our trained model.  To do this, we need to generate an <em>instance</em> for the evaluation to look at.  It is constructed from numbers in the same order as our arff file.  The exception is that we are not going to provide a value for the final field of the speech act type.  We will assign that to the a missing value.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">gen-instance</span> <span class="p">[</span><span class="nv">dataset</span> <span class="p">[</span><span class="nv">val0</span> <span class="nv">val1</span> <span class="nv">val2</span> <span class="nv">val3</span> <span class="nv">val4</span><span class="p">]]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">i</span> <span class="p">(</span><span class="k">new </span><span class="nv">Instance</span> <span class="mi">6</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">doto </span><span class="nv">i</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">.setValue</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">double </span><span class="nv">val0</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">.setValue</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">double </span><span class="nv">val1</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">.setValue</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">double </span><span class="nv">val2</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">.setValue</span> <span class="mi">3</span> <span class="p">(</span><span class="nb">double </span><span class="nv">val3</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">.setValue</span> <span class="mi">4</span> <span class="p">(</span><span class="nb">double </span><span class="nv">val4</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">.setValue</span> <span class="mi">5</span> <span class="p">(</span><span class="nf">Instance/missingValue</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">.setDataset</span> <span class="nv">dataset</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can use this function in a prediction function to get our answer back</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">predict</span> <span class="p">[</span><span class="nv">ev</span> <span class="nv">d</span> <span class="nv">vals</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">v</span>  <span class="p">(</span><span class="nf">.evaluateModelOnce</span> <span class="nv">ev</span> <span class="nv">classifier</span> <span class="p">(</span><span class="nf">gen-instance</span> <span class="nv">d</span> <span class="nv">vals</span><span class="p">))]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">case</span> <span class="nv">v</span>
</span><span class='line'>      <span class="mf">0.0</span> <span class="ss">:statement</span>
</span><span class='line'>      <span class="mf">1.0</span> <span class="ss">:question</span>
</span><span class='line'>      <span class="mf">2.0</span> <span class="ss">:expressive</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Calling the predict function would look something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">results</span> <span class="p">(</span><span class="nf">train-classifier</span> <span class="s">&quot;speech-acts-input-all.arff&quot;</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">predictor</span> <span class="p">(</span><span class="ss">:evaluator</span> <span class="nv">results</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">data</span> <span class="p">(</span><span class="ss">:data</span> <span class="nv">results</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nf">predict</span> <span class="nv">predictor</span> <span class="nv">data</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">])</span>
</span><span class='line'><span class="c1">;; -&gt; :expressive</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that we have the parsing piece and the classification piece, we can put everything together.</p>

<h3>Putting it all together</h3>

<p>We finally have all the details we need write a <code>classify-text</code> function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">classify-text</span> <span class="p">[</span><span class="nv">text</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">stats</span> <span class="p">(</span><span class="nf">parser/gen-stats</span> <span class="nv">text</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">features</span> <span class="p">[(</span><span class="ss">:sen-len</span> <span class="nv">stats</span><span class="p">)</span>
</span><span class='line'>                  <span class="p">(</span><span class="ss">:nn-num</span> <span class="nv">stats</span><span class="p">)</span>
</span><span class='line'>                  <span class="p">(</span><span class="ss">:end-in-n</span> <span class="nv">stats</span><span class="p">)</span>
</span><span class='line'>                  <span class="p">(</span><span class="ss">:begin-v</span> <span class="nv">stats</span><span class="p">)</span>
</span><span class='line'>                  <span class="p">(</span><span class="ss">:wh-num</span> <span class="nv">stats</span><span class="p">)]]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">weka/predict</span> <span class="nv">predictor</span> <span class="nv">data</span> <span class="nv">features</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">classify-text</span> <span class="s">&quot;I like cheese&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1">;; -&gt; :statement</span>
</span><span class='line'><span class="p">(</span><span class="nf">classify-text</span> <span class="s">&quot;How do you make cheese&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1">;; -&gt; :question</span>
</span><span class='line'><span class="p">(</span><span class="nf">classify-text</span> <span class="s">&quot;Right on&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1">;; -&gt; :expressive</span>
</span></code></pre></td></tr></table></div></figure>


<p>Yea! It worked.  We finally have something that will read in text and tell us its best guess of a speech act, all without punctuation.  Let&rsquo;s quickly review what we have done.</p>

<h3>Summary</h3>

<ul>
<li>Gather data sets of statements, questions, and expressives</li>
<li>Parse text and annotate it with POS tags using Stanford CoreNLP</li>
<li>Choose features of the data to analyze and generate arff files</li>
<li>Use Weka explorer to try out the best classification algorithims</li>
<li>Programatically use weka to train classifier and predict a new instance</li>
<li>Write a program to tie it all together</li>
</ul>


<p>It&rsquo;s funny how a simple thing like asking whether something is a statement or question gets you knee deep in Natural Language Processing and Machine Learning pretty fast.</p>

<p>We&rsquo;ve learned a lot, now let&rsquo;s have a bit of fun.  Now that we can classify speech acts, we can make a sort of proto chat bot with a really limited responses.</p>

<h3>Proto Chat Bot</h3>

<p>Here we are going to be a bit loose and actually check if a question mark is used.  If it is, we will automatically mark it as a question.  Otherwise, we will classify it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">respond</span> <span class="p">[</span><span class="nv">text</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">question-mark?</span> <span class="p">(</span><span class="nb">re-find </span> <span class="o">#</span><span class="s">&quot;\?$&quot;</span> <span class="nv">text</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">type</span> <span class="p">(</span><span class="k">if </span><span class="nv">question-mark?</span>
</span><span class='line'>               <span class="ss">:question</span>
</span><span class='line'>               <span class="p">(</span><span class="nf">classify-text</span> <span class="nv">text</span><span class="p">))]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">case</span> <span class="nv">type</span>
</span><span class='line'>      <span class="ss">:question</span> <span class="s">&quot;That is an interesting question.&quot;</span>
</span><span class='line'>      <span class="ss">:statement</span> <span class="s">&quot;Nice to know.&quot;</span>
</span><span class='line'>      <span class="ss">:expressive</span> <span class="s">&quot;:)&quot;</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We just need a quick repl and main function now:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">repl</span> <span class="p">[]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">do</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">print </span><span class="s">&quot;&gt;&gt; &quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">flush</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">input</span> <span class="p">(</span><span class="nf">read-line</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">if-not </span><span class="p">(</span><span class="nb">= </span><span class="nv">input</span> <span class="s">&quot;quit&quot;</span><span class="p">)</span>
</span><span class='line'>     <span class="p">(</span><span class="nf">do</span>
</span><span class='line'>       <span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nf">try</span> <span class="p">(</span><span class="nf">c/respond</span> <span class="nv">input</span><span class="p">)</span>
</span><span class='line'>                     <span class="p">(</span><span class="nf">catch</span> <span class="nv">Exception</span> <span class="nv">e</span> <span class="p">(</span><span class="nb">str </span><span class="s">&quot;Sorry: &quot;</span> <span class="nv">e</span> <span class="s">&quot; - &quot;</span> <span class="p">(</span><span class="nf">.getMessage</span> <span class="nv">e</span><span class="p">)))))</span>
</span><span class='line'>       <span class="p">(</span><span class="nf">recur</span><span class="p">))</span>
</span><span class='line'>     <span class="p">(</span><span class="k">do </span><span class="p">(</span><span class="nb">println </span><span class="s">&quot;Bye!&quot;</span><span class="p">)</span>
</span><span class='line'>         <span class="p">(</span><span class="nf">System/exit</span> <span class="mi">0</span><span class="p">)))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">-main</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Hello.  Let&#39;s chat.&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">flush</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">repl</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Testing it out with <code>lein run</code>, we can have a little chat:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">Hello.</span>  <span class="nv">Let</span><span class="ss">&#39;s</span> <span class="nv">chat.</span>
</span><span class='line'><span class="nv">&gt;&gt;</span> <span class="nv">Hi</span>
</span><span class='line'><span class="err">:</span><span class="p">)</span>
</span><span class='line'><span class="nv">&gt;&gt;</span> <span class="nv">Do</span> <span class="nv">you</span> <span class="nv">know</span> <span class="nv">where</span> <span class="nv">I</span> <span class="nv">can</span> <span class="nv">go</span> <span class="nv">to</span> <span class="nv">buy</span> <span class="nv">cheese</span>
</span><span class='line'><span class="nv">That</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">interesting</span> <span class="nv">question.</span>
</span><span class='line'><span class="nv">&gt;&gt;</span> <span class="nv">I</span> <span class="nv">am</span> <span class="nv">a</span> <span class="nv">big</span> <span class="nv">cheese</span> <span class="nv">fan</span>
</span><span class='line'><span class="nv">Nice</span> <span class="nv">to</span> <span class="nv">know.</span>
</span><span class='line'><span class="nv">&gt;&gt;</span> <span class="nv">you</span> <span class="nv">are</span> <span class="nv">quite</span> <span class="nv">smart</span>
</span><span class='line'><span class="nv">Nice</span> <span class="nv">to</span> <span class="nv">know.</span>
</span><span class='line'><span class="nv">&gt;&gt;</span> <span class="nv">bye</span>
</span><span class='line'><span class="err">:</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Want more?  Check out the code <a href="https://github.com/gigasquid/speech-acts-classifier">https://github.com/gigasquid/speech-acts-classifier</a>.</p>

<p><em>Special thanks to <a href="https://twitter.com/ohpauleez">Paul deGrandis</a> for allowing me to pick his awesome brain on AI things</em></p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2015/10/20/speech-act-classification-for-text-with-clojure//blog/page/2/index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/08/25/converstations-with-datomic-3/">
		
			Conversations With Datomic - Part 3</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2015-08-25T10:28:00-04:00" pubdate data-updated="true">Aug 25<span>th</span>, 2015</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>, <a class='category' href='/blog/categories/clojure/'>Clojure</a>, <a class='category' href='/blog/categories/datomic/'>Datomic</a>


</div>
    </div>
		<p><img src="https://avatars0.githubusercontent.com/u/1478702?v=3&s=200"></p>

<p><em>This is a continuation of the <a href="http://gigasquidsoftware.com/blog/2015/08/15/conversations-with-datomic/">first</a> and
<a href="http://gigasquidsoftware.com/blog/2015/08/19/conversations-with-datomic-part-2/">second</a> conversations in which topics such as creating databases,
learning facts, querying, and time traveling were discussed.  Today&rsquo;s topics include architecture, caching, and scaling.</em></p>

<p><strong>Human:</strong>  Hello again <a href="http://www.datomic.com/">Datomic</a>. Ready to talk again?</p>

<p><strong>Datomic:</strong> Sure.  I think you wanted to ask me some questions about how I would fit in with your other systems.</p>

<p><strong>Human:</strong> Yes.  Like I was saying earlier, I think your abilities to learn facts, reason about them, and keep track of the history of all those facts is really great.
I am interested in having you work with me every day, but first I want to understand your components so that I can make sure you are a good fit for us.</p>

<p><strong>Datomic:</strong> I would be happy to explain my architecture to you.  Perhaps showing you this picture is the best way to start.</p>

<p><img src="http://c2.staticflickr.com/6/5723/20819693686_f9ec3852c3_z.jpg"></p>

<p>I am made of three main parts: my <em>transactors</em>, my <em>peers</em>, and my <em>storage</em>.</p>

<p><strong>Human</strong>:  What is a <em>peer</em>?</p>

<p><strong>Datomic</strong>:  A <em>peer</em> is an application that is using the peer library.  In our last conversations,  we were talking through the Clojure api with <code>datomic.api</code>.  The application, or process, that is running this api is called a peer.  There can be many of these, all having conversations with me.</p>

<p><strong>Human</strong>: The peers then talk to your <em>transactor</em>?</p>

<p><strong>Datomic</strong> Yes. The peers talk to my transactor whenever you call <code>transact</code> with the peer library.  It is the central coordinator between all the peers and processes the requests using <em>ACID</em> transactions, and then sends the facts off to storage.</p>

<p><strong>Human:</strong>  Could you remind me what <em>ACID</em> stands for again?  I always forget.  The first one is <em>Atomic</em> right?</p>

<p><strong>Datomic:</strong> That is right.  I am <em>Atomic</em> in that every transaction you send to me is all or nothing.  If for some reason, one part of it fails, I will reject the entire transaction and leave my database unchanged.</p>

<p>The C is for <em>Consistency</em>.  This means that I provide every peer with a consistent view of facts over time and transactions.  I provide a global ordering of transactions across all the peers with my transactor and peers will always see all the transactions up to their current time without any gaps.</p>

<p><strong>Human:</strong> What if a peer is behind the global time?  How do they catch up to know about the new facts that were transacted by a different peer?</p>

<p><strong>Datomic:</strong> After one peer sends me a successful transaction with some new facts, I will notify all the peers about them.</p>

<p><strong>Human:</strong> Cool. That takes care of the A and C in ACID. What about the I?</p>

<p><strong>Datomic:</strong> It stands for Isolated.  It makes sure that even through there are many peers having conversations with me, transactions are executed serially.  This happens naturally with my transactor.  Since there is only one transactor, transactions are always executed serially.</p>

<p><strong>Human</strong>:  In the picture, why are there are two transactors then?</p>

<p><strong>Datomic</strong>:  Oh, that is for High Availability.  When I startup my system, I can launch two running transactors, but hold one in reserve.  Just on the off chance something happens to the main one, I will swap in the failover one to keep things running smoothly.</p>

<p>The final D in <em>ACID</em> is for Durability.  Once a transaction has been committed by my transactor, it is shipped off to storage for safe keeping.</p>

<p><strong>Human:</strong> What exactly is this storage?</p>

<p><strong>Datomic:</strong> Instead of storing datoms, I send <em>segments</em>, which are closely related datoms,  to storage.  I have quite a few options for storage:</p>

<ul>
<li>Dev mode &ndash; which just runs within my transactor and writes to the local file system.</li>
<li>SQL database</li>
<li>DynamoDB</li>
<li>Cassandra</li>
<li>Riak</li>
<li>Couchbase</li>
<li>Infinispan memory cluster</li>
</ul>


<p><strong>Human:</strong> Which one is the best to use?</p>

<p><strong>Datomic:</strong> <em>The best one to use is the one that you are already have in place at work</em>.  This way, I can integrate seamlessly with your other systems.</p>

<p><strong>Human:</strong> Oh, we didn&rsquo;t really talk about caching.  Can you explain how you do that?</p>

<p><strong>Datomic:</strong> Certainly.  It is even worth another picture.</p>

<p><img src="http://c2.staticflickr.com/6/5630/20852217305_90506481fe.jpg"></p>

<p>Each peer has a its own <em>working set</em> of recent datoms along with a index to all the rest of the datoms in storage in memory.  When the peer has a query for a datom, it first checks to see if it has it locally in its memory cache.  If it can&rsquo;t find it there, then it will ask for a segment of that datom from storage.  Storage will return that datom along with other related datoms in that segment so that the peer can cache that in memory to make it faster for the next query.</p>

<p><strong>Human:</strong> That seems really different from other databases, where the client constantly requests queries from a server.</p>

<p><strong>Datomic:</strong> Yes.  When most questions can be answered from the local memory, responses are really fast.  You don&rsquo;t need to hit storage unless you really need too.  You can even add an extra layer of caching with memcached.</p>

<p><strong>Human:</strong> That sounds great.  I can&rsquo;t wait tell you about all of our data.  We talked a bit about your querying ability earlier, can you do the same queries that our other standard relational databases do, like joins?</p>

<p><strong>Datomic:</strong> Oh yes.  In fact, with me, you don&rsquo;t need to specify your joins explicitly.  I use <em>Datalog</em>, which is based on logic, so my joins are implicit.  I will figure out exactly what I need to put together to answer your query without you having to spell it out for me.</p>

<p><strong>Human:</strong> Ok.  I know that I can map some of my data that is already in other database tables to you.  What about other types of irregular data, like graphs, or sparse data.</p>

<p><strong>Datomic:</strong> I am actually very proud of my data model.  It is extremely flexible.  Since I store things on such a granular datom level, you don&rsquo;t need to map your logical data model to my physical model.  I can handle <em>rectangular</em> table shaped data quite happily along with graph data, sparse data, or other <em>non-rectangular</em> data.</p>

<p><strong>Human:</strong> That sounds great.  What do I need to know about your scaling?</p>

<p><strong>Datomic:</strong> I really excel at reads.  All you have to do is elastically add another peer to me for querying.  I am not really a good fit for write scale, like big data, or log file analysis.  You will find me most happy with data that is valuable information of record and has history that is important, like transaction, medical, or inventory data.  I am also really good at being flexible for development and operations since I can use many different types of storage.  I have worked with many web and cloud apps.</p>

<p><strong>Human:</strong> Thanks for answering all my questions.  I think you might fit in quite well with our other systems.</p>

<p><strong>Datomic:</strong> Great!</p>

<p><strong>Human:</strong> One more thing, this conversation has been great, but do you have any training resources for me and my other human coworkers?</p>

<p><strong>Datomic:</strong> Sure thing. There are a few really good resources on the <a href="http://www.datomic.com/training.html">Datomic Training Site</a>.  I would suggest watching the videos there and pairing them with:</p>

<ul>
<li><a href="https://github.com/stuarthalloway/presentations/blob/master/Nov2014/DayOfDatomicNov2014.pdf?raw=true">The slides for the videos</a> which have the labs to work through form the videos.</li>
<li><a href="https://github.com/Datomic/day-of-datomic">The Day of Datomic Repo</a> which has lots of great examples to play with.</li>
<li><a href="http://docs.datomic.com/">Tne Datomic Development Resources</a>, which include the docs on the <a href="http://docs.datomic.com/clojure/index.html">Clojure API</a></li>
</ul>


<p>Also, if you want to confirm that your data is good fit for me, I suggest you describe your data to the <a href="https://groups.google.com/forum/#!forum/datomic">Datomic Google Group</a>.  They are nice and knowledgeable group of humans.</p>

<p><strong>Human:</strong> Thanks again Datomic!  I will grab another cookie and check it out!</p>

<p><strong>Datomic:</strong> What is it with humans and cookies?&hellip;</p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2015/08/25/converstations-with-datomic-3//blog/page/2/index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/08/19/conversations-with-datomic-part-2/">
		
			Conversations With Datomic Part 2</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2015-08-19T08:56:00-04:00" pubdate data-updated="true">Aug 19<span>th</span>, 2015</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>, <a class='category' href='/blog/categories/clojure/'>Clojure</a>, <a class='category' href='/blog/categories/datomic/'>Datomic</a>


</div>
    </div>
		<p><img src="https://avatars0.githubusercontent.com/u/1478702?v=3&s=200"></p>

<p><em>The following is a continuation of the first <a href="http://gigasquidsoftware.com/blog/2015/08/15/conversations-with-datomic/">conversation</a> which touched on schema creation and querying.  This conversation includes learning new facts, time, and the sometimes unfortunate reality of lawyers.</em></p>

<p><strong>Human:</strong>  Hi <a href="http://www.datomic.com/">Datomic</a>.  I am back from my tea and cookies break.  I really enjoyed talking with you, could we continue our conversation?</p>

<p><strong>Datomic:</strong> Certainly.  Let me see, where did we leave off?</p>

<p><strong>Human:</strong> Let me check my <a href="https://gist.github.com/gigasquid/92a1effb14fe4f6ced59">notes</a>.  Oh yes, we had created a database and filled it with facts about some dogs and owners.  You showed me how to ask you things about the facts, like which dogs liked cheese.</p>

<p><strong>Datomic:</strong> Ah yes.  We were just getting to the really interesting part about how I learn new facts without forgetting the past ones.</p>

<p><strong>Human:</strong> Can you please explain a bit more about how you learn new facts?</p>

<p><strong>Datomic:</strong> Sure.  I learn facts when you tell me to <em>add</em> a new fact about some entity, or to <em>retract</em> a fact about it.  It will probably make more sense with an example.  Let&rsquo;s take the dog with the name &ldquo;Tiny&rdquo; that I know about.  Could you please ask me about the dog and all of the attributes?</p>

<p><strong>Human:</strong> Alright.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/pull</span> <span class="p">(</span><span class="nf">d/db</span> <span class="nv">conn</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">*</span><span class="p">]</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:db/id</span> <span class="mi">17592186045423</span>
</span><span class='line'> <span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span>
</span><span class='line'> <span class="ss">:dog/breed</span> <span class="s">&quot;Great Dane&quot;</span>
</span><span class='line'> <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Cheese&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>There is an entity (dog) with the name &ldquo;Tiny&rdquo; who is a Great Dane and his favorite-treat is Cheese.  I am not really sure why the Cheese is capitalized, but I am sure it makes sense to a human.</p>

<p><strong>Human:</strong> Oh right.  Well, now that you mention it, I am not really sure about the cheese thing either. Can I just remove that fact?</p>

<p><strong>Datomic:</strong> Well, you can tell me to <em>retract</em> that fact by sending me a transaction in the form of <code>[:db/retract entity-id attribute value]</code>.  In the case of the dog, since the name attribute is unique, you can just give me the selector for Tiny like this <code>[:dog/name "Tiny"]</code>.</p>

<p><strong>Human:</strong> Like this?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/transact</span> <span class="nv">conn</span> <span class="p">[[</span><span class="ss">:db/retract</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">]</span> <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Cheese&quot;</span><span class="p">]])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong> Exactly.  I have retracted that fact about &ldquo;Tiny&rdquo;.  Go ahead and ask me about all of Tiny&rsquo;s attributes again.</p>

<p><strong>Human:</strong>  Ok.  I use <code>(d/db conn)</code> for the current database value right?</p>

<p><strong>Datomic:</strong> Yes. But if you are going to be asking me multiple questions about this database value, you should not repeat the <code>(d/db conn)</code> all the time.</p>

<p><strong>Human:</strong> Oh. What should I do instead?</p>

<p><strong>Datomic:</strong> The connection with me is like a ref.  Just like other refs, you should deref it once to get the database value and then use the value repeatedly. This single database value will provide consistency for all your queries.</p>

<p><strong>Human:</strong> That makes sense.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">db-tiny-no-cheese</span> <span class="p">(</span><span class="nf">d/db</span> <span class="nv">conn</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">d/pull</span> <span class="nv">db-tiny-no-cheese</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">*</span><span class="p">]</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:db/id</span> <span class="mi">17592186045423</span>, <span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span>, <span class="ss">:dog/breed</span> <span class="s">&quot;Great Dane&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Tiny is a Great Dane.</p>

<p><strong>Human:</strong> So you don&rsquo;t know anything about the <code>:dog/favorite-treat</code> for &ldquo;Tiny&rdquo;?</p>

<p><strong>Datomic:</strong> At this particular time, I do not have anything to assert about the favorite-treat of Tiny.  However, I still remember everything about all the facts that you have told me.  For each transaction that you send me, I have a notion of a point in time like <em>t0</em>, <em>t1</em>, <em>t2</em>.  I have a complete database value for each one of those points in time.  In fact, you can look at <em>all</em> of my assertions and retractions that I have learned about using the <code>d/history</code> function on the database value.  This asks me to expose my history, which is normally hidden in favor of the <em>present</em>. I will return back a special database containing all the assertions and retractions across time.  Any queries that you ask me will have a fifth <em>datom</em> field to help you distinguish the difference.</p>

<p><strong>Human:</strong>  A fifth datom field?</p>

<p><strong>Datomic:</strong> A <em>datom</em> consists of the following parts: the entity, the attribute, the value, transaction, and an operation which tells you if the fact was added or retracted (e a v tx op).  Why don&rsquo;t you try using the <code>d/history</code> function to ask me about all the facts having to do with Tiny?  I suggest using the datalog query</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="o">&#39;</span><span class="p">[</span><span class="ss">:find</span> <span class="nv">?e</span> <span class="nv">?a</span> <span class="nv">?v</span> <span class="nv">?tx</span> <span class="nv">?op</span>
</span><span class='line'>  <span class="ss">:in</span> <span class="nv">$</span>
</span><span class='line'>  <span class="ss">:where</span> <span class="p">[</span><span class="nv">?e</span> <span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">]</span>
</span><span class='line'>         <span class="p">[</span><span class="nv">?e</span> <span class="nv">?a</span> <span class="nv">?v</span> <span class="nv">?tx</span> <span class="nv">?op</span><span class="p">]]</span>
</span></code></pre></td></tr></table></div></figure>


<p>which will return all the entity, attribute, value, transaction, and operation facts I ever knew about Tiny.</p>

<p><strong>Human:</strong> Ok.  Here goes.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/q</span> <span class="o">&#39;</span><span class="p">[</span><span class="ss">:find</span> <span class="nv">?e</span> <span class="nv">?a</span> <span class="nv">?v</span> <span class="nv">?tx</span> <span class="nv">?op</span>
</span><span class='line'>       <span class="ss">:in</span> <span class="nv">$</span>
</span><span class='line'>       <span class="ss">:where</span> <span class="p">[</span><span class="nv">?e</span> <span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">]</span>
</span><span class='line'>       <span class="p">[</span><span class="nv">?e</span> <span class="nv">?a</span> <span class="nv">?v</span> <span class="nv">?tx</span> <span class="nv">?op</span><span class="p">]]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">d/history</span> <span class="nv">db-tiny-no-cheese</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="o">#</span><span class="p">{[</span><span class="mi">17592186045423</span> <span class="mi">63</span> <span class="s">&quot;Tiny&quot;</span>       <span class="mi">13194139534314</span> <span class="nv">true</span><span class="p">]</span>
</span><span class='line'>  <span class="p">[</span><span class="mi">17592186045423</span> <span class="mi">64</span> <span class="s">&quot;Great Dane&quot;</span> <span class="mi">13194139534314</span> <span class="nv">true</span><span class="p">]</span>
</span><span class='line'>  <span class="p">[</span><span class="mi">17592186045423</span> <span class="mi">65</span> <span class="s">&quot;Cheese&quot;</span>     <span class="mi">13194139534314</span> <span class="nv">true</span><span class="p">]</span>
</span><span class='line'>  <span class="p">[</span><span class="mi">17592186045423</span> <span class="mi">65</span> <span class="s">&quot;Cheese&quot;</span>     <span class="mi">13194139534320</span> <span class="nv">false</span><span class="p">]}</span>
</span></code></pre></td></tr></table></div></figure>


<p>During one transaction, you told me to add three facts about an entity:</p>

<ul>
<li>The <code>:dog/name</code> attribute, (which I refer to as 63), has the value of &ldquo;Tiny&rdquo;.</li>
<li>The <code>:dog/breed</code> attribute, (which I refer to as 64), has the value of &ldquo;Great Dane&rdquo;.</li>
<li>The <code>:dog/favorite-treat</code> attribute, (which I refer to as 65), has the value of &ldquo;Cheese&rdquo;.</li>
</ul>


<p>During another transaction, you told me to retract a fact regarding the attribute <code>:dog/favorite-treat</code> about the same entity.</p>

<p><strong>Human:</strong> Wow, that is really cool.  Is there a way that I can <em>travel back in time</em> to see the world as it was during that first transaction?</p>

<p><strong>Datomic:</strong> Yes.  I am practically a Tardis.  You can use the <code>d/as-of</code> function with a database value and the transaction number and you can time travel.  Using that <em>time traveled</em> database value, you can ask me about all the facts I knew as of that time.</p>

<p><strong>Human:</strong> I can&rsquo;t wait to try this.  Ok, let&rsquo;s go back to the time when I first asserted the fact that Tiny liked cheese.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/pull</span> <span class="p">(</span><span class="nf">d/as-of</span> <span class="nv">db-tiny-no-cheese</span> <span class="mi">13194139534314</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">*</span><span class="p">]</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong>  Hold on.  We are time traveling!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:db/id</span> <span class="mi">17592186045423</span>
</span><span class='line'> <span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span>
</span><span class='line'> <span class="ss">:dog/breed</span> <span class="s">&quot;Great Dane&quot;</span>
</span><span class='line'> <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Cheese&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Tiny is a Great Dane whose favorite treat is Cheese.</p>

<p><strong>Human:</strong> Fantastic! Let&rsquo;s go back to the future now, ummm I mean present. Time is a bit wibbly wobbly.</p>

<p><strong>Datomic:</strong> Just take the <code>as-of</code> function off of the database value and you will be back in the <em>present</em>.</p>

<p><strong>Human:</strong> Hmmm&hellip; Do I have to do a <em>retract</em> every time I want to change a value?  For example, the dog named Fido has a favorite treat of a Bone right now, right?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/pull</span> <span class="nv">db-tiny-no-cheese</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">*</span><span class="p">]</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Fido&quot;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:db/id</span> <span class="mi">17592186045421</span>
</span><span class='line'> <span class="ss">:dog/name</span> <span class="s">&quot;Fido&quot;</span>
</span><span class='line'> <span class="ss">:dog/breed</span> <span class="s">&quot;Mix&quot;</span>
</span><span class='line'> <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Bone&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Yes, it is a &ldquo;Bone&rdquo;.</p>

<p><strong>Human:</strong> So, if I want to change it to be &ldquo;Eggs&rdquo;,  do I need to retract the current value of &ldquo;Bone&rdquo; first and then add the fact of &ldquo;Eggs&rdquo;?</p>

<p><strong>Datomic:</strong> You certainly could do that and I would understand you perfectly.  However, if you simply assert a new value for an existing attribute, I will automatically add the retraction for you.</p>

<p><strong>Human:</strong> Cool.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/transact</span> <span class="nv">conn</span> <span class="p">[{</span><span class="ss">:db/id</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Fido&quot;</span><span class="p">]</span>
</span><span class='line'>                   <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Eggs&quot;</span><span class="p">}])</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">d/pull</span> <span class="p">(</span><span class="nf">d/db</span> <span class="nv">conn</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">*</span><span class="p">]</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Fido&quot;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:db/id</span> <span class="mi">17592186045421</span>
</span><span class='line'> <span class="ss">:dog/name</span> <span class="s">&quot;Fido&quot;</span>
</span><span class='line'> <span class="ss">:dog/breed</span> <span class="s">&quot;Mix&quot;</span>
</span><span class='line'> <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Eggs&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Fido now has a favorite-treat of &ldquo;Eggs&rdquo;.</p>

<p><strong>Human:</strong> This is really neat.  You <em>never</em> forget any facts?</p>

<p><strong>Datomic:</strong> Nope. Well, except in really exceptional circumstances that usually involve lawyers.</p>

<p><strong>Human:</strong> Lawyers?</p>

<p><strong>Datomic:</strong> Sigh.  Yes, well in some unique situations, you might be under a legal obligation to really <em>forget</em> certain facts and totally remove them from the database. There is a special tool that you can use to <em>excise</em> the data.  However, I will store a fact that <em>something</em> was deleted at that time. I just won&rsquo;t be able to remember <em>what</em>.</p>

<p><strong>Human:</strong> That doesn&rsquo;t sound fun.</p>

<p><strong>Datomic:</strong> I prefer to keep all my facts intact.</p>

<p><strong>Human:</strong> I can definitely see that. Well, on a happier subject, I have been very impressed with you during our conversations.  Having a time traveling database that can reason about facts seems like a really useful thing.  Also, you are also really nice.</p>

<p><strong>Datomic:</strong> Awww shucks, thanks.  For a human, you are really nice too.</p>

<p><strong>Human:</strong> I was thinking about the possibility of you coming and working with me every day. Would you mind chatting some more to me about your architecture?  I want to understand how your would fit with our other systems.</p>

<p><strong>Datomic:</strong> Certainly. I would love that.  Do you want to talk about it now, or have another cookie break first?</p>

<p><strong>Human:</strong> Now that you mention cookies&hellip; Let&rsquo;s take a short break and we will talk again soon.</p>

<p><em>(P.S. Humans, there are some great <a href="http://www.datomic.com/training.html">Datomic Training Videos</a> if you want to learn more)</em></p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2015/08/19/conversations-with-datomic-part-2//blog/page/2/index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/08/15/conversations-with-datomic/">
		
			Conversations With Datomic</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2015-08-15T10:29:00-04:00" pubdate data-updated="true">Aug 15<span>th</span>, 2015</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>, <a class='category' href='/blog/categories/clojure/'>Clojure</a>, <a class='category' href='/blog/categories/datomic/'>Datomic</a>


</div>
    </div>
		<p><img src="https://avatars0.githubusercontent.com/u/1478702?v=3&s=200"></p>

<p><strong>Human:</strong> Hi <a href="http://www.datomic.com/">Datomic</a>.   I have been hearing good things about you.  I would like to talk to you and get to know you.  Is that alright?</p>

<p><strong>Datomic:</strong> Sure!  I would be happy to talk with you.  What language would you like to converse in?</p>

<p><strong>Human:</strong>  I like Clojure.</p>

<p><strong>Datomic:</strong>  That is one of my favorites too.  You know how to setup a Leiningen project right?</p>

<p><strong>Human:</strong> Oh yes.  What dependency should I use?</p>

<p><strong>Datomic:</strong> Just use <code>[com.datomic/datomic-free "0.9.5206"]</code>.</p>

<p><strong>Human:</strong> Got it.  Do you mind if I record our conversation in a namespaced file, so that I can refer back to it later?</p>

<p><strong>Datomic:</strong>  Not a problem.  Make sure to require <code>datomic.api</code> when you set it up.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">conversations.datomic</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">require</span> <span class="p">[</span><span class="nv">datomic.api</span> <span class="ss">:as</span> <span class="nv">d</span><span class="p">]))</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Human:</strong>  All right.  I am all setup up.  I don&rsquo;t really know where to start, so maybe you can tell me a little about yourself.</p>

<p><strong>Datomic:</strong>  I would be happy to.  I am a database of facts.  Would you like to create a database with me?</p>

<p><strong>Human:</strong>  Sure.  How do I do that?</p>

<p><strong>Datomic:</strong> For a casual conversation like this, we can use a in memory database with a uri like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">uri</span> <span class="s">&quot;datomic:mem://first-conversation&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then we can create the database and simply connect to it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/create-database</span> <span class="nv">uri</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">conn</span> <span class="p">(</span><span class="nf">d/connect</span> <span class="nv">uri</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Human:</strong> So, being a database, obviously you store things.  What sort of things to you store?</p>

<p><strong>Datomic:</strong>  I store facts about things, which I call <em>datoms</em>.</p>

<p><strong>Human:</strong>  That sound neat.  How do I tell you a fact to store?  For example, what if I want you to store a fact about a dog, like its name?</p>

<p><strong>Datomic:</strong>  Ah.  Well the name of a dog is an attribute.  First, you need to tell me about the name attribute, so that I can use it to store the fact for you .  You can describe the attribute in the form of a map like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:db/id</span> <span class="p">(</span><span class="nf">d/tempid</span> <span class="ss">:db.part/db</span><span class="p">)</span>
</span><span class='line'> <span class="ss">:db/ident</span> <span class="ss">:dog/name</span>
</span><span class='line'> <span class="ss">:db/valueType</span> <span class="ss">:db.type/string</span>
</span><span class='line'> <span class="ss">:db/cardinality</span> <span class="ss">:db.cardinality/one</span>
</span><span class='line'> <span class="ss">:db/unique</span> <span class="ss">:db.unique/identity</span>
</span><span class='line'> <span class="ss">:db/doc</span> <span class="s">&quot;Name of the Dog&quot;</span>
</span><span class='line'> <span class="ss">:db.install/_attribute</span> <span class="ss">:db.part/db</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p> This map is a set of facts, (called <em>datoms</em>),  about an entity.  In this
 case, the entity is an attribute. Attributes, in turn, can be used to describe other entities, like a dog. I will explain the different parts to you.</p>

<ul>
<li><code>db/id</code> is the internal id of the fact. With <code>(d/tempid :db.part/db)</code>, I will generate it for you, so you don&rsquo;t have to worry about it.</li>
<li><code>db/ident</code> is the human readable reference for it. While I am fine just referring to the attribute by an id, humans prefer text.  This says that you can refer to this attribute by the namespaced keyword <code>:dog/name</code>.</li>
<li><code>db/valueType</code> tells me the type of the attribute.  The dog&rsquo;s name is a string.</li>
<li><code>db/cardinality</code> lets me know if there is a one-to-one relationship with the entity or not. In our case, a dog has only one name.</li>
<li><code>db/unique</code> is if that attribute is unique for an entity.  In our example case, we are saying that a dog can be uniquely identified by its name.</li>
<li><code>db/doc</code> is some documentation for humans that explains a bit more about the attribute.</li>
<li><code>db.install/_attribute</code> tells me that this is an schema attribute that I should store with the other things like it.</li>
</ul>


<p><strong>Human:</strong> I think I understand. Let me try one out for myself.  So dog breed would be this?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:db/id</span> <span class="p">(</span><span class="nf">d/tempid</span> <span class="ss">:db.part/db</span><span class="p">)</span>
</span><span class='line'> <span class="ss">:db/ident</span> <span class="ss">:dog/breed</span>
</span><span class='line'> <span class="ss">:db/valueType</span> <span class="ss">:db.type/string</span>
</span><span class='line'> <span class="ss">:db/cardinality</span> <span class="ss">:db.cardinality/one</span>
</span><span class='line'> <span class="ss">:db/doc</span> <span class="s">&quot;Breed of the Dog&quot;</span>
</span><span class='line'> <span class="ss">:db.install/_attribute</span> <span class="ss">:db.part/db</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong>  Yes!  I think you got it.  Let&rsquo;s try one more.</p>

<p><strong>Human:</strong> Ok.  How about the dog&rsquo;s favorite treat?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:db/id</span> <span class="p">(</span><span class="nf">d/tempid</span> <span class="ss">:db.part/db</span><span class="p">)</span>
</span><span class='line'> <span class="ss">:db/ident</span> <span class="ss">:dog/favorite-treat</span>
</span><span class='line'> <span class="ss">:db/valueType</span> <span class="ss">:db.type/string</span>
</span><span class='line'> <span class="ss">:db/cardinality</span> <span class="ss">:db.cardinality/one</span>
</span><span class='line'> <span class="ss">:db/doc</span> <span class="s">&quot;Dog&#39;s Favorite Treat to Eat&quot;</span>
</span><span class='line'> <span class="ss">:db.install/_attribute</span> <span class="ss">:db.part/db</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong> You got it.  Now, that you have these attributes, you can give them to me using a transaction with the connection.</p>

<p><strong>Human:</strong> Ok.  Do you want that in a specific format?</p>

<p><strong>Datomic:</strong>  Yes.  Please send it to me using the form:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/transact</span> <span class="nv">conn</span> <span class="p">[</span><span class="nv">....facts....</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Human:</strong> Sounds good.  I will put the dog schema datoms we discussed in a vector and call it <code>dog-schema</code> and then send it to you.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">dog-schema</span>  <span class="p">[{</span><span class="ss">:db/id</span> <span class="p">(</span><span class="nf">d/tempid</span> <span class="ss">:db.part/db</span><span class="p">)</span>
</span><span class='line'>                   <span class="ss">:db/ident</span> <span class="ss">:dog/name</span>
</span><span class='line'>                   <span class="ss">:db/valueType</span> <span class="ss">:db.type/string</span>
</span><span class='line'>                   <span class="ss">:db/cardinality</span> <span class="ss">:db.cardinality/one</span>
</span><span class='line'>                   <span class="ss">:db/unique</span> <span class="ss">:db.unique/identity</span>
</span><span class='line'>                   <span class="ss">:db/doc</span> <span class="s">&quot;Name of the Dog&quot;</span>
</span><span class='line'>                   <span class="ss">:db.install/_attribute</span> <span class="ss">:db.part/db</span><span class="p">}</span>
</span><span class='line'>                  <span class="p">{</span><span class="ss">:db/id</span> <span class="p">(</span><span class="nf">d/tempid</span> <span class="ss">:db.part/db</span><span class="p">)</span>
</span><span class='line'>                   <span class="ss">:db/ident</span> <span class="ss">:dog/breed</span>
</span><span class='line'>                   <span class="ss">:db/valueType</span> <span class="ss">:db.type/string</span>
</span><span class='line'>                   <span class="ss">:db/cardinality</span> <span class="ss">:db.cardinality/one</span>
</span><span class='line'>                   <span class="ss">:db/doc</span> <span class="s">&quot;Breed of the Dog&quot;</span>
</span><span class='line'>                   <span class="ss">:db.install/_attribute</span> <span class="ss">:db.part/db</span><span class="p">}</span>
</span><span class='line'>                  <span class="p">{</span><span class="ss">:db/id</span> <span class="p">(</span><span class="nf">d/tempid</span> <span class="ss">:db.part/db</span><span class="p">)</span>
</span><span class='line'>                   <span class="ss">:db/ident</span> <span class="ss">:dog/favorite-treat</span>
</span><span class='line'>                   <span class="ss">:db/valueType</span> <span class="ss">:db.type/string</span>
</span><span class='line'>                   <span class="ss">:db/cardinality</span> <span class="ss">:db.cardinality/one</span>
</span><span class='line'>                   <span class="ss">:db/doc</span> <span class="s">&quot;Dog&#39;s Favorite Treat to Eat&quot;</span>
</span><span class='line'>                   <span class="ss">:db.install/_attribute</span> <span class="ss">:db.part/db</span><span class="p">}])</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">d/transact</span> <span class="nv">conn</span> <span class="nv">dog-schema</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong> The transaction was fine.  I know all about those dog attributes now.</p>

<p><strong>Human:</strong>  I would like to also add a schema for owners for the dogs now.  I think I know how to describe the name of the owner, but I don&rsquo;t know how to express how the owner has dogs.</p>

<p><strong>Datomic:</strong> Ah. I that case you can specify the <code>db:valueType</code> as a <code>ref</code> type.  This lets me know that it references another entity.</p>

<p><strong>Human:</strong>  Do I need to tell you that is a type of dog somehow?</p>

<p><strong>Datomic:</strong> No.  I am pretty smart that way.  I will figure it out
  once you try to tell me about some real entities.  In fact, entities don&rsquo;t have types. A ref attribute can reference <em>any</em> entity.</p>

<p><strong>Human:</strong>  Cool.  Well, in that case, here is the owner schema.  The owner has a name and some dogs.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">owner-schema</span> <span class="p">[{</span><span class="ss">:db/id</span> <span class="p">(</span><span class="nf">d/tempid</span> <span class="ss">:db.part/db</span><span class="p">)</span>
</span><span class='line'>                    <span class="ss">:db/ident</span> <span class="ss">:owner/name</span>
</span><span class='line'>                    <span class="ss">:db/valueType</span> <span class="ss">:db.type/string</span>
</span><span class='line'>                    <span class="ss">:db/cardinality</span> <span class="ss">:db.cardinality/one</span>
</span><span class='line'>                    <span class="ss">:db/unique</span> <span class="ss">:db.unique/identity</span>
</span><span class='line'>                    <span class="ss">:db/doc</span> <span class="s">&quot;Name of the Owner&quot;</span>
</span><span class='line'>                    <span class="ss">:db.install/_attribute</span> <span class="ss">:db.part/db</span><span class="p">}</span>
</span><span class='line'>                   <span class="p">{</span><span class="ss">:db/id</span> <span class="p">(</span><span class="nf">d/tempid</span> <span class="ss">:db.part/db</span><span class="p">)</span>
</span><span class='line'>                    <span class="ss">:db/ident</span> <span class="ss">:owner/dogs</span>
</span><span class='line'>                    <span class="ss">:db/valueType</span> <span class="ss">:db.type/ref</span>
</span><span class='line'>                    <span class="ss">:db/cardinality</span> <span class="ss">:db.cardinality/many</span>
</span><span class='line'>                    <span class="ss">:db/doc</span> <span class="s">&quot;Dogs of the Owner&quot;</span>
</span><span class='line'>                    <span class="ss">:db.install/_attribute</span> <span class="ss">:db.part/db</span><span class="p">}])</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">d/transact</span> <span class="nv">conn</span> <span class="nv">owner-schema</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong>  The transaction is fine.  I now know about the attributes that dogs and owners have.  Would you like to tell me some facts about specific dogs and owners?</p>

<p><strong>Human:</strong>  Yes. Bob is an owner.  He has two dogs. Fluffy is a poodle whose favorite treat is cheese, and Fido is a mixed breed, whose favorite treat is a bone.  Lucy is also an owner who has one dog named Tiny.  Tiny is a Great Dane whose favorite treat is cheese.</p>

<p>I am a bit confused how to represent the dogs of the owners. How do I do that?</p>

<p><strong>Datomic:</strong>  That is easy, just nest the datoms for dogs under the <code>:owner/dogs</code> attribute. You just need to create datoms for them.  Each dog or owner will by its own map.  Use <code>:db/id</code> set to <code>(d/tempid :db.part/user)</code> so I can generate it for you.  Then use each attribute from the schema as the key and let me know the value.</p>

<p><strong>Human:</strong>  Like this?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/transact</span> <span class="nv">conn</span> <span class="p">[{</span><span class="ss">:db/id</span> <span class="p">(</span><span class="nf">d/tempid</span> <span class="ss">:db.part/user</span><span class="p">)</span>
</span><span class='line'>                   <span class="ss">:owner/name</span> <span class="s">&quot;Bob&quot;</span>
</span><span class='line'>                   <span class="ss">:owner/dogs</span> <span class="p">[{</span><span class="ss">:db/id</span> <span class="p">(</span><span class="nf">d/tempid</span> <span class="ss">:db.part/user</span><span class="p">)</span>
</span><span class='line'>                                 <span class="ss">:dog/name</span> <span class="s">&quot;Fluffy&quot;</span>
</span><span class='line'>                                 <span class="ss">:dog/breed</span> <span class="s">&quot;Poodle&quot;</span>
</span><span class='line'>                                 <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Cheese&quot;</span><span class="p">}</span>
</span><span class='line'>                                <span class="p">{</span><span class="ss">:db/id</span> <span class="p">(</span><span class="nf">d/tempid</span> <span class="ss">:db.part/user</span><span class="p">)</span>
</span><span class='line'>                                 <span class="ss">:dog/name</span> <span class="s">&quot;Fido&quot;</span>
</span><span class='line'>                                 <span class="ss">:dog/breed</span> <span class="s">&quot;Mix&quot;</span>
</span><span class='line'>                                 <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Bone&quot;</span><span class="p">}]}</span>
</span><span class='line'>                  <span class="p">{</span><span class="ss">:db/id</span> <span class="p">(</span><span class="nf">d/tempid</span> <span class="ss">:db.part/user</span><span class="p">)</span>
</span><span class='line'>                   <span class="ss">:owner/name</span> <span class="s">&quot;Lucy&quot;</span>
</span><span class='line'>                   <span class="ss">:owner/dogs</span> <span class="p">[{</span><span class="ss">:db/id</span> <span class="p">(</span><span class="nf">d/tempid</span> <span class="ss">:db.part/user</span><span class="p">)</span>
</span><span class='line'>                                 <span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span>
</span><span class='line'>                                 <span class="ss">:dog/breed</span> <span class="s">&quot;Great Dane&quot;</span>
</span><span class='line'>                                 <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Cheese&quot;</span><span class="p">}]}])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong>  Exactly right.  I now know the facts about Bob and Lucy and their dogs.</p>

<p><strong>Human:</strong>  Umm, how do I query you about the facts that your know?  For example, how do I ask you about the dog named Tiny?</p>

<p><strong>Datomic:</strong>  There are a couple a ways to inquire about facts I know.  To find out about the attributes of a specific dog, or entity, I would recommend using <code>d/pull</code>.  You can ask me in the form of this to get all the attributes for a given dog name.  Note that this works since the dog name is a way to uniquely identify the dog:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/pull</span> <span class="p">(</span><span class="nf">d/db</span> <span class="nv">conn</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">*</span><span class="p">]</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Human:</strong>  What is the <code>(d/db conn)</code> all about?</p>

<p><strong>Datomic:</strong>  That function returns the current database value of the connection. The facts I know change during time.  Every time there is a transaction, I consider the time to be different and there is a new database value.  The <code>d/db</code> function gives you the most recent value that I know about.</p>

<p><strong>Human:</strong> I am assuming the <code>[*]</code> is a wildcard that means give me all the attributes for that dog?</p>

<p><strong>Datomic:</strong>  Exactly right.</p>

<p><strong>Human:</strong> Ok.  Tell me about Tiny.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/pull</span> <span class="p">(</span><span class="nf">d/db</span> <span class="nv">conn</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">*</span><span class="p">]</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:db/id</span> <span class="mi">17592186045424</span>
</span><span class='line'> <span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span>
</span><span class='line'> <span class="ss">:dog/breed</span> <span class="s">&quot;Great Dane&quot;</span>
</span><span class='line'> <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Cheese&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Tiny is a Great Dane that has a favorite treat of Cheese.</p>

<p><strong>Human:</strong>  This is fun.  What about more complicated questions.  How do I ask about the name of the owner of the dog &ldquo;Tiny&rdquo;?</p>

<p><strong>Datomic:</strong>  For that I would ask using the <em>datalog</em> query <code>d/q</code>.  It uses logic to unify your query with all of my facts and give you the result.  The query itself would be a vector with logic statements inside like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="o">&#39;</span><span class="p">[</span><span class="ss">:find</span> <span class="nv">?owner-name</span>
</span><span class='line'>  <span class="ss">:where</span> <span class="p">[</span><span class="nv">?dog</span> <span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">]</span>
</span><span class='line'>         <span class="p">[</span><span class="nv">?owner</span> <span class="ss">:owner/dogs</span> <span class="nv">?dog</span><span class="p">]</span>
</span><span class='line'>         <span class="p">[</span><span class="nv">?owner</span> <span class="ss">:owner/name</span> <span class="nv">?owner-name</span><span class="p">]]</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Human:</strong>  Whoa.  What is the deal with those question marks?</p>

<p><strong>Datomic:</strong> The things with the question marks are considered as variables that we will <em>unify</em> to find the answer.  For example, we are looking for something that we are going to call <code>?owner-name</code>. I am going the use the following constraints with my facts to try to find the answer:</p>

<ul>
<li>There is an entity that we are going to call <code>?dog</code> that has the attribute <code>:dog/name</code> that is &ldquo;Tiny&rdquo;</li>
<li>There is an entity that we are going to call <code>?owner</code> that has an attribute <code>:owner/dogs</code> that is the same as the <code>?dog</code> entity</li>
<li>That same <code>?owner</code> entity also has an attribute <code>:owner/name</code> that has the value <code>?owner-name</code></li>
</ul>


<p><strong>Human:</strong>  Alright, so when I ask for this query, do I need to give you a database value too?</p>

<p><strong>Datomic:</strong>  Yes.  They should have the form of:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/q</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">datalog-query</span><span class="p">]</span> <span class="nv">db-value</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Remember, to get the current db value use <code>(d/db conn)</code>.</p>

<p><strong>Human:</strong>  Ok.  Here we go.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/q</span> <span class="o">&#39;</span><span class="p">[</span><span class="ss">:find</span> <span class="nv">?owner-name</span>
</span><span class='line'>       <span class="ss">:where</span> <span class="p">[</span><span class="nv">?dog</span> <span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">]</span>
</span><span class='line'>              <span class="p">[</span><span class="nv">?owner</span> <span class="ss">:owner/dogs</span> <span class="nv">?dog</span><span class="p">]</span>
</span><span class='line'>              <span class="p">[</span><span class="nv">?owner</span> <span class="ss">:owner/name</span> <span class="nv">?owner-name</span><span class="p">]]</span>
</span><span class='line'>     <span class="p">(</span><span class="nf">d/db</span> <span class="nv">conn</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong></p>

<p>The answer is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="o">#</span><span class="p">{[</span><span class="s">&quot;Lucy&quot;</span><span class="p">]}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Human:</strong>  What if I want to pass the dog name as a parameter?  How do I communicate that to you?</p>

<p><strong>Datomic:</strong>  You will need to use an <code>in</code> clause in the query like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="o">&#39;</span><span class="p">[</span><span class="ss">:find</span> <span class="p">[</span><span class="nv">blah</span><span class="p">]</span>
</span><span class='line'>   <span class="ss">:in</span> <span class="nv">$</span> <span class="nv">?dog-name</span>
</span><span class='line'>   <span class="ss">:where</span> <span class="p">[</span><span class="nv">blah</span><span class="p">]]</span>
</span></code></pre></td></tr></table></div></figure>


<p>The $ is shorthand for the database value and the <code>?dog-name</code> is what you will pass in as a parameter in the query after the db-value.</p>

<p><strong>Human:</strong>  Like this?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/q</span> <span class="o">&#39;</span><span class="p">[</span><span class="ss">:find</span> <span class="nv">?owner-name</span>
</span><span class='line'>       <span class="ss">:in</span> <span class="nv">$</span> <span class="nv">?dog-name</span>
</span><span class='line'>       <span class="ss">:where</span> <span class="p">[</span><span class="nv">?dog</span> <span class="ss">:dog/name</span> <span class="nv">?dog-name</span><span class="p">]</span>
</span><span class='line'>              <span class="p">[</span><span class="nv">?owner</span> <span class="ss">:owner/dogs</span> <span class="nv">?dog</span><span class="p">]</span>
</span><span class='line'>              <span class="p">[</span><span class="nv">?owner</span> <span class="ss">:owner/name</span> <span class="nv">?owner-name</span><span class="p">]]</span>
</span><span class='line'>     <span class="p">(</span><span class="nf">d/db</span> <span class="nv">conn</span><span class="p">)</span> <span class="s">&quot;Tiny&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong>  Exactly right.  The answer is Lucy again.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="o">#</span><span class="p">{[</span><span class="s">&quot;Lucy&quot;</span><span class="p">]}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Human:</strong>  I think I am getting the hang of this!  Another quick question.  How would I go about asking you which dogs have cheese as their favorite treat?  I would want the dog&rsquo;s name and breed back.</p>

<p><strong>Datomic:</strong>  You would simply construct another datalog query.  This time I would recommend that you combine the <code>pull</code> syntax within the <code>find</code> part of the query.  The <code>pull</code> syntax is great at selecting attributes from an entity.  So the <code>find</code> part would look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">[(</span><span class="nf">pull</span> <span class="nv">?dog</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="ss">:dog/breed</span><span class="p">])</span> <span class="nv">...</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will return the attributes of the <code>:dog/name</code> and the <code>:dog/breed</code>.  The three dots on the end will let me know that you want a collection returned, so I will give you back a simple vector with the entity attributes requested, instead of the set of vectors I normally give back.</p>

<p>The <code>where</code> section of the query is going to look for the <code>?dog</code> entity that matches the <code>:dog/favorite-treat</code> attribute with &ldquo;Cheese&rdquo;.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="o">&#39;</span><span class="p">[</span><span class="ss">:find</span> <span class="p">[(</span><span class="nf">pull</span> <span class="nv">?dog</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="ss">:dog/breed</span><span class="p">])</span> <span class="nv">...</span><span class="p">]</span>
</span><span class='line'>  <span class="ss">:where</span> <span class="p">[</span><span class="nv">?dog</span> <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Cheese&quot;</span><span class="p">]]</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Human:</strong>  Then I put it together with the current database value in a <code>d/q</code> function?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/q</span> <span class="o">&#39;</span><span class="p">[</span><span class="ss">:find</span> <span class="p">[(</span><span class="nf">pull</span> <span class="nv">?dog</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="ss">:dog/breed</span><span class="p">])</span> <span class="nv">...</span><span class="p">]</span>
</span><span class='line'>       <span class="ss">:where</span> <span class="p">[</span><span class="nv">?dog</span> <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Cheese&quot;</span><span class="p">]]</span>
</span><span class='line'>     <span class="p">(</span><span class="nf">d/db</span> <span class="nv">conn</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong> Yup.  The answer is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">[{</span><span class="ss">:dog/name</span> <span class="s">&quot;Fluffy&quot;</span>, <span class="ss">:dog/breed</span> <span class="s">&quot;Poodle&quot;</span><span class="p">}</span>
</span><span class='line'> <span class="p">{</span><span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span>, <span class="ss">:dog/breed</span> <span class="s">&quot;Great Dane&quot;</span><span class="p">}]</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Human:</strong>  Thanks so much.  I think I beginning to get the hang of schemas and queries.  What other things do I need to know about you?</p>

<p><strong>Datomic:</strong>  Well, you have just scratched the surface really.  One of the most interesting things about me is that I never forget facts.  You can add new facts, like Tiny&rsquo;s favorite food is now hotdogs, but I won&rsquo;t forget that he liked cheese at another point in time.</p>

<p><strong>Human:</strong> That sounds really interesting.  I think I need some tea and cookies before I delve into that.  Let&rsquo;s take a short break and talk again soon.</p>

<p><strong>Datomic:</strong>  My pleasure.  I look forward to it.</p>

<p><em>Special thanks to <a href="https://twitter.com/ohpauleez">Paul deGrandis</a> for
the conversation idea :)</em></p>

<p><em>(P.S. Humans, there are some great <a href="http://www.datomic.com/training.html">Datomic Training Videos</a> if you want to learn more)</em></p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2015/08/15/conversations-with-datomic//blog/page/2/index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/05/30/wilds-horses-things-and-creativity/">
		
			Wild Horses, Things, and Creativity</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2015-05-30T10:53:00-04:00" pubdate data-updated="true">May 30<span>th</span>, 2015</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>


</div>
    </div>
		<p><img src="https://nmbdesigner.files.wordpress.com/2012/05/where-the-wild-things-are-2.jpeg"></p>

<p>Sometimes I want to create something and I run into a limitation or
constraint. It is at this point where I am tempted to give up and say
that I just <em>can&rsquo;t</em> do that.</p>

<p>At this time,  I remember Maurice Sendak and the origins of <em>Where
the Wild Things Are</em>.  In this <a href="http://www.pbs.org/now/arts/sendak.html">interview with Bill Moyers</a>, he explains
how the book was originally titled <em>Where the Wild Horses Are</em>, but he
couldn&rsquo;t draw horses.</p>

<blockquote><p>She was this torrential woman, passionate woman, who could spot talent 10 miles away. I had no education. I did not go to art school. My drawing was so crude. I had shines on shoes like in Mutt &lsquo;n&rsquo; Jeff in Walt Disney. And she saw through that monstrous crudity and cultivated me, really made me grow up. And then, it was time to do my own picture book.</p>

<p>And I came to her with a title that was &ldquo;Where the Wild Horses Are.&rdquo; And she just loved that. It was so poetic and evocative. And she gave me a contract based on &ldquo;Where the Wild Horses Are.&rdquo; And then, it turned out after some very few months to her chagrin and anger, I couldn&rsquo;t draw horses. The whole book would have to be full of horses to make the book make sense.</p>

<p>And when I tried a number of things, I remember the acid tones. She said, &ldquo;Maurice, what can you draw?&rdquo; Okay. Cause she was investing in a full color picture book. That was an enormous thing back then.</p>

<p>And so, I thought well things, things.</p></blockquote>

<p>Limits or constraints cannot hold back creativity.  But it can help
mold it in surprising directions.</p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2015/05/30/wilds-horses-things-and-creativity//blog/page/2/index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/05/22/how-not-to-panic-while-writing-a-clojure-book/">
		
			How Not to Panic While Writing a Clojure Book</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2015-05-22T09:11:00-04:00" pubdate data-updated="true">May 22<span>nd</span>, 2015</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>, <a class='category' href='/blog/categories/clojure/'>Clojure</a>


</div>
    </div>
		<p>I made it to that magical moment when the Clojure book I had been working on so long was published and I could actually hold it in my hand.</p>

<p><img src="https://pbs.twimg.com/media/CDWsQPCUgAERViK.jpg"></p>

<p>It was an immense project and I am very happy that it is finally done.  Since then, I met some people that are interested in writing books as well.
They asked if I had any insights or tips having gone through the process as a first time author.  I have collected them in this post in hopes that they will be helpful to those going through the process themselves.</p>

<p>The very first thing to do is to get an outline for your book.</p>

<h3>Start with an Outline</h3>

<p>Ideas are soft and squishy.  They drift into different shapes like clouds, and can melt away just as quickly.  One of the hardest things to do was trying to arrange all those ideas in my head into an initial form that would serve as the structure for the entire book.  I would pick up a pen and paper, start feeling overwhelmed, and suddenly remember I had something else very pressing to do.  I successfully avoided starting a book for quite a while, until one day I cornered myself.  I decided that I write my book outline on a long plane flight.  With salted peanuts as fuel, and nowhere to escape, I finally wrote an outline.  It wasn&rsquo;t perfect but it was a start and looking back and it was not too far off.  Here it is in all of its original roughness.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Title: Living Clojure
</span><span class='line'>
</span><span class='line'>From beginning steps to thriving in a functional world
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>(Each Chapter will follow quotes from Alice in Wonderland and very use ideas from some examples)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Book 1 - Beginner steps
</span><span class='line'>
</span><span class='line'>Chapter 1 - Are you comfortable?  Talk about how OO is comfortable but there is another world out there and new way of thinking functionally.
</span><span class='line'>            White Rabbit goes by
</span><span class='line'>Chapter 2 - Forms & Functions - Falling down the rabbit hole
</span><span class='line'>Chapter 3 - Functional Transformations - Growing bigger and smaller - Key to thinking functionally is about transforming data from one shape to another shape.
</span><span class='line'>            Map & Reduce
</span><span class='line'>Chapter 4 - Embracing side effects  - Clojure is impure functional language (The rabbit's glove)  - Cover do and io stuff. Also basic stuff about 
</span><span class='line'>            STM atoms and agents/ Protocols
</span><span class='line'>Chapter 5 - Libraries, Libraries  - - how to use Leiningen
</span><span class='line'>            build system. Where to find clojure libraries, how to use
</span><span class='line'>            Serpents - camel-snake-kebab
</span><span class='line'>Chapter 6 - core.asyc - Tea Party introduction to the core.async library
</span><span class='line'>Chapter 7 - Clojure web - Chesire cat  - introduction to Ring, Cheshire library, ClojureScript and OM 
</span><span class='line'>
</span><span class='line'>Book 2 - From here to there - thriving in a functional world
</span><span class='line'>
</span><span class='line'>Training plan for thriving in a functional world.
</span><span class='line'>
</span><span class='line'>Chapter 8 - Join the community - Surround yourself with other Clojure enthusiats
</span><span class='line'>  - Twitter clojure
</span><span class='line'>  - Github account
</span><span class='line'>  - Clojure mailing list
</span><span class='line'>  - Prismatic clojure news
</span><span class='line'>  - Meetup for local community group.  If there is not one in your area. start one!
</span><span class='line'>  - Attend a Clojure conj
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Chatpter 9 - Practice and build up 
</span><span class='line'>Like Couch to 5K 7 week training program to work up to
</span><span class='line'>practicing Clojure
</span></code></pre></td></tr></table></div></figure>


<p>Now that I had an outline.  I just needed to figure out how long it would take me to write the book.</p>

<h3>However Long You Think It Will Take &ndash; You Are Wrong</h3>

<p>Having never written a book before, I had <em>no idea</em> how much work it would be.  The closest thing I had to compare it to was writing a blog post.  I figured writing a chapter would be roughly equivalent to writing a blog post.  If I could go back in time, this is the moment where my future self would pour a glass of ice water on my past self.  Writing a book is nothing like that.  It is a lot of time and work.  If I <em>had</em> to compare it now to writing blog posts, the process would be this.</p>

<pre><code>- You write a blog post.
- You rewrite the blog post.
- You write a second blog post.
- You rewrite that blog post and the first one too.
- You write another blog post.
- You rewrite all three post .....
</code></pre>

<p>So, if you have to commit to deadlines, make sure you remember how hard it will be, and then double the number.</p>

<p>Speaking of deadlines, they suck, but you should have them.</p>

<h3>Make Deadlines</h3>

<p>Deadlines are not fun.  In fact, deadlines might even be a source of potential panic.  But for me, they were necessary evil.  There were a few beautiful times when inspiration came knocking at my door and I couldn&rsquo;t wait to start writing.  But most of the time, inspiration was off somewhere else eating biscuits.  The only thing that actually moved the book along was me knowing that I needed to get the next chunk done by a certain date.</p>

<p>I found the best thing to do was to set aside a small bit of time on a daily basis to write something.</p>

<h3>Routine, Routine, Routine</h3>

<p>A daily routine was the most crucial thing for me.  Life is really busy with work and family.  It is so easy to get overwhelmed with daily life.  I decided that mornings would work best for me.  So I would stumble in to my computer an hour before work, with a hot cup of tea in hand, and write something.  Some days I actually did quite a bit.  Other days, I would write one sentence and declare it done.  But, I would always do <em>something</em>.  Even though those small slices of time didn&rsquo;t seem like a lot, they added up over the course of a week.</p>

<p>Another curious thing happens when you do something, even a little bit, day after day.  You start to get better at it.</p>

<h3>Writing is a Different Skill from Coding</h3>

<p>I was used to writing code all day.  I found that the code writing skills are not the same as writing about code.  In fact, I found it really hard to do at the start.  But, just like writing code, you get better with practice.  And to get better at anything, feedback is really important.</p>

<h3>Get and Trust Feedback</h3>

<p>After each chapter, I would get feedback from my editor.  She was awesome and provided ways for me to improve the experience for the reader.  I lost track of how many times I rewrote that first chapter, but each time it would get a bit better and I would improve as well.  After the book was about half done it was sent out to others for technical review.  They provided feedback not only on the writing style but also the technical content, making sure that it all made sense.</p>

<p>The feedback loop is much slower for writing a book than writing code, but it is just as vital.  The great people providing feedback are you closest partners in this.  You need to trust them.  Especially during the roughest time, the middle of the book.</p>

<h3>The Middle Bit is the Hardest</h3>

<p>I found the hardest time was about halfway through the book.  The initial excitement of the new endeavor had long since worn off.  It seemed like such a mountain of a task, with no end in sight.  I questioned my decision to continue with it daily.  My routine and deadlines kept me moving forward.  But my circle of friends and family kept me sane.  It was great to have an outlet, not only to vent my frustration with my slow progress, but to get kind encouragement to keep my spirits up.</p>

<p>During these dark days, I also ate cheese.</p>

<h3>Celebrate Your Small Victories</h3>

<p>At the end of every chapter or deadline I would fix myself a nice plate of cheese and crackers.  You have to celebrate the small wins.  Cheese is also very tasty.</p>

<p>When the book was finally done.  I had a really tasty plate, complete with Stilton, Brie, and a dependable Cheddar.  I was incredibly happy to be finished. But I knew that I definitely could have not done it without the help of others.</p>

<h3>Thank Everyone that Supported You</h3>

<p>Writing a book is a huge undertaking that is utterly impossible to do alone.  I could have not done it without the help and support of my editor, reviewers, family, friends, as well as the entire Clojure Community.  I am so thankful to all of you that helped my in this project.  You are great.</p>

<p>So, should you go ahead and write that book?</p>

<h3>Do It</h3>

<p>Yes, you should write that book and share your knowledge.  Don&rsquo;t panic, remember to breathe, get some cheese and tea, and go for it!  It will be awesome.</p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2015/05/22/how-not-to-panic-while-writing-a-clojure-book//blog/page/2/index.html#disqus_thread">Comments</a></span>
	
</div>
</article>

<nav id="pagenavi">
    
        <a href="/" class="prev">Prev</a>
    
    
        <a href="/blog/page/3/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>

    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2017

    Carin Meier
. Powered by <a href="http://octopress.org">Octopress</a> | 
    Theme <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'squidsblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
