
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Squid's Blog</title>
    <meta name="author" content="Carin Meier">
    
	<meta name="description" content="Published on: Mar 16th, 2016 Tags: All, Clojure It happened again. I was sitting down reading a paper and I came across the phrase Kolmogorov- &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Squid's Blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='http://fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <script src="/javascripts/ajaxify.js"></script>
   
    
    

</head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated">
    <div id="headerbg">
        Squid's Blog
    </div>
</h1>
<br>

<ul id="social-links" style="text-align:center">
  
  
  
  
  
  
  
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/about/index.html">About</a></li>
	<li id="ajax"><a href="/speaking/index.html">Speaking</a></li>
	<li id="ajax"><a href="/books/index.html">Books</a></li>
	<li id="ajax"><a href="/blog/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
</ul>




</header>

<div id="toload">
<!-- begin toload --> 
    <div id="content" class="inner">
        


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/03/16/kolmogorov-uspensky-machine/">
		
			Kolmogorov-Uspensky Machine</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2016-03-16T18:19:00-04:00" pubdate data-updated="true">Mar 16<span>th</span>, 2016</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>, <a class='category' href='/blog/categories/clojure/'>Clojure</a>


</div>
    </div>
		<p>It happened again.  I was sitting down reading a paper and I came across the phrase <em>Kolmogorov-Uspensky machine</em> and I had no idea what it was.  My initial reaction was just to move on.  It probably wasn&rsquo;t important, I told myself, just a detail that I could skim over.  I took a sip of my tea and continued on. The next paragraph it appeared <em>again</em>.  It was just sticking up like a thread waiting to be pulled. Still, I resisted.  After all, I wasn&rsquo;t even near my computer.  I would have to get up an walk into the other room.   After considering it for a moment, inertia won out and I continued my reading.  There it was <em>once more</em>.  This time right in the same paragraph, silently mocking me.  I knew I had to do something so I strode to my computer and pulled the thread.</p>

<h2>What is a Kolmogorov-Uspensky machine?</h2>

<p>The first thing I found is that the Kolmogorov-Uspensky machine, (also referred to as KUM), is very similar to the <a href="https://en.wikipedia.org/wiki/Turing_machine">Turing machine</a>.  In fact, it shares the same computational class of being Turing-complete.</p>

<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Turing_machine_2b.svg/320px-Turing_machine_2b.svg.png"></p>

<p>The Turing machine operates on a tape divided into cells.  The head can move along the tape and read and write to it.  The tape is the storage for the machine.  Its movements are controlled by a collection of instructions which will be executed if certain prerequisites are met. The difference between the Turing machine  and a Kolmogorov-Uspensky machine is that the KUM has a tape that can change topology.  It&rsquo;s a graph.</p>

<p>The graph of a KUM machine is not just any graph.  It&rsquo;s a particular kind of graph.  It must have the property that if you start at a one vertex, all the other vertexes are uniquely addressable.  The graph also has a active node which, in turn, has a active neighborhood of other nodes associated with it.  This is not unlike the Turing machine&rsquo;s head that points to the current cell.  To figure out what do, the KUM machine looks at the graph to decide on what instruction to execute.  The instructions can consist of adding a node or edge to the active neighborhood, removing a node or edge from the active neighborhood, or halting.</p>

<p>After spending some time reading and researching, I felt like a had some idea of what a Kolmogorov-Uspensky machine was but it was still a bit fuzzy.  I wanted to really dig in and experience it by trying to implement one.  I found an esoteric programming language called <a href="https://esolangs.org/wiki/Eodermdrome">Eodermdrome</a> that fit the bill and set to work building it out in Clojure.</p>

<h2>Eodermdrome</h2>

<p>An Eodermdrome program creates graphs from a string of letters.  For example the graph of <em>abcdae</em> would produce</p>

<p><img src="https://github.com/gigasquid/eodermdrome/blob/master/images/abcdae.png?raw=true"></p>

<p>The program itself consists of series of commands or rules.  The command will be executed if the following prereqs are met:</p>

<ul>
<li>The match graph in the command is a subgraph of the system graph.</li>
<li>If an input set is part of the command, the input character read of the system input must match it.</li>
</ul>


<p>A command is of the form:</p>

<ul>
<li><strong>match-graph graph-replacement</strong>

<ul>
<li>This will execute if the match-graph is a subgraph and then transform the match to the replacement.</li>
<li>Example:<code>a abc</code></li>
</ul>
</li>
<li><strong>(input-set) match-graph graph-replacement</strong>.

<ul>
<li>This will execute if the match is a subgraph and if the next character of the system input matches.  On executing, it will read one char from the input and then transform the match graph with the replacement.</li>
<li>Example: <code>(1) a abc</code></li>
</ul>
</li>
<li><strong>match-graph (output) graph-replacement.</strong>

<ul>
<li>This will execute if the match-graph is a subgraph. On executing, it will print the output to the system and transform the match with the replacement.</li>
<li>Example: <code>a (1) abc</code></li>
</ul>
</li>
<li><strong>(input-set) match-graph (output) graph-replacement.</strong>

<ul>
<li>This will execute if the match is a subgraph and if the next character of the system input matches.  On executing, it will read one char from the input, print the output to the system, and then transform the match graph with the replacement.</li>
<li>Example: <code>(0) a (1) abc</code></li>
</ul>
</li>
</ul>


<p>Comments are also allowed as text in between commas.  In this implementation, they must be contained on a single line.  Example: <code>,this is a comment,(1) a abc</code></p>

<p>The initial state of the graph with a program is the denoted by the graph string <em>thequickbrownfoxjumpsoverthelazydog</em>.</p>

<p><img src="https://github.com/gigasquid/eodermdrome/blob/master/images/thequickbrownfoxjumpsoverthelazydog.png?raw=true" title="" ></p>

<p>We now have all we need to walk through an example program in the Kolmogorov-Uspensky machine.</p>

<h3>An add program</h3>

<p>Let&rsquo;s take program for adding two string of ones together separated by zeros.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>,takes input of ones separated by zeros and adds the ones, thequickbrownfoxjumpsoverthelazydog a
</span><span class='line'>(1) a ab
</span><span class='line'>(0) a a
</span><span class='line'>ab (1) a</span></code></pre></td></tr></table></div></figure>


<p>Given a system input of &ldquo;101&rdquo;, it will print out &ldquo;11&rdquo;.  Let&rsquo;s walk through what happens in the program.</p>

<p><strong>Step 1</strong> &ndash; The program starts with our graph in the initial state of our beloved <em>thequickbrownfoxjumpsoverthelazydog</em> configuration.</p>

<p><img src="https://github.com/gigasquid/eodermdrome/blob/master/images/step-1.png?raw=true" title="" ></p>

<p><strong>Step 2</strong> &ndash; The first instruction matches <code>,takes input of ones separated by zeros and adds the ones, thequickbrownfoxjumpsoverthelazydog a</code> with he active subgraph being the whole graph. It is replaced by the single graph node <em>a</em>.</p>

<p><img src="https://github.com/gigasquid/eodermdrome/blob/master/images/step-2.png?raw=true"></p>

<p><strong>Step 3</strong> &ndash; The next instruction set <code>(1) a ab</code> <em>a</em> subgraph matches and takes a 1 off the input and transforms the graph to <em>ab</em>.</p>

<p><img src="https://github.com/gigasquid/eodermdrome/blob/master/images/step-3.png?raw=true"></p>

<p><strong>Step 4</strong> &ndash; The instruction set <code>(0) a a</code> also matches (since a is a subgraph of ab) and it takes a zero off the input and transforms back the <em>a</em> to <em>a</em> so the graph is still <em>ab</em>.</p>

<p><img src="https://github.com/gigasquid/eodermdrome/blob/master/images/step-4.png?raw=true"></p>

<p><strong>Step 5</strong> &ndash;  The instruction set <code>ab (1) a</code> now matches and a one prints out and the <em>ab</em> graph changes to <em>a</em>.</p>

<p><img src="https://github.com/gigasquid/eodermdrome/blob/master/images/step-5.png?raw=true"></p>

<p><strong>Step 6</strong> &ndash; Now, the <code>(1) a ab</code> instruction matches, it takes another 1 off the input (our last one) and transforms to <em>ab</em></p>

<p><img src="https://github.com/gigasquid/eodermdrome/blob/master/images/step-3.png?raw=true"></p>

<p><strong>Step 7</strong> &ndash; Finally, <code>ab (1) a</code> matches and it prints out a 1 and rewrites the graph to back to <em>a</em></p>

<p><img src="https://github.com/gigasquid/eodermdrome/blob/master/images/step-5.png?raw=true"></p>

<p>There are no more matching subgraphs without input required for instructions, so the program ends.</p>

<h2>Parting thoughts and threads</h2>

<p>The Kolmogorov-Uspensky machine is quite interesting. Not only is the idea of graph storage and rewriting appealing, it is also pretty powerful compared to Turing machines.  In fact, Dima Grigoriev proved that Turing machines cannot simulate Kolmogorov machines in real time.</p>

<p>It&rsquo;s been quite a fun and enriching jaunt.  The next time you see an unfamiliar term or concept, I encourage you to pull the thread. You never know where it will take you. It&rsquo;s a great way to enlarge your world.</p>

<p>If you are interested in the code and hacking for yourself, here is the repo  <a href="https://github.com/gigasquid/eodermdrome">https://github.com/gigasquid/eodermdrome</a>.</p>

<p>Other good resources on KUM:</p>

<ul>
<li><a href="http://research.microsoft.com/en-us/um/people/gurevich/opera/78.pdf">On Kolmogorov Machines And Related Issues</a></li>
<li><a href="https://books.google.com/books?id=SpTv44Ia-J0C&amp;pg=PA284&amp;lpg=PA284&amp;dq=active+node+kolmogorov+uspensky+machine&amp;source=bl&amp;ots=uQQSLaaKOS&amp;sig=9-V_m8z-Yh9zlzy6vX9MplGMbjw&amp;hl=en&amp;sa=X&amp;ved=0ahUKEwjy8820rMDLAhVByYMKHWP5A8oQ6AEILDAC#v=onepage&amp;q=active%20node%20kolmogorov%20uspensky%20machine&amp;f=false">Kolmogorov&rsquo;s Heritage in Mathematics</a></li>
<li><a href="http://dl.acm.org/citation.cfm?id=202846">What is a &ldquo;pointer machine&rdquo;</a></li>
</ul>


		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2016/03/16/kolmogorov-uspensky-machine//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/02/10/fairy-tale-word-vectors/">
		
			Fairy Tale Word Vectors</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2016-02-10T21:27:00-05:00" pubdate data-updated="true">Feb 10<span>th</span>, 2016</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>, <a class='category' href='/blog/categories/clojure/'>Clojure</a>


</div>
    </div>
		<p><img src="http://c2.staticflickr.com/2/1558/24654386380_bda44419a8_n.jpg"></p>

<p>This post continues our exploration from the last blog post <a href="http://gigasquidsoftware.com/blog/2016/02/06/why-hyperdimensional-socks-never-match/">Why Hyperdimensional Socks Never Match</a>.  We are still working our way through <a href="http://redwood.berkeley.edu/pkanerva/papers/kanerva09-hyperdimensional.pdf">Kanerva&rsquo;s paper</a>.  This time, with the basics of hypervectors under our belts, we&rsquo;re ready to explore how words can be expressed as context vectors.  Once in a high dimensional form, you can compare two words to see how similar they are and even perform reasoning.</p>

<p>To kick off our word vector adventure, we need some words.  Preferring whimsy over the Google news, our text will be taken from ten freely available fairy tale books on <a href="http://www.gutenberg.org/">http://www.gutenberg.org/</a>.</p>

<h3>Gather ye nouns</h3>

<p>Our goal is to assemble a frequency matrix, with all the different nouns as the rows and the columns will be the counts of if the word appears or not in the document.  Our matrix will be binary with just 1s and 0s.  The <em>document</em> will be a sentence or fragment of words.  A small visualization is below.</p>

<table>
<thead>
<tr>
<th></th>
<th> Noun          </th>
<th align="center"> Doc1</th>
<th> Doc2</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td> flower        </td>
<td align="center"> 1   </td>
<td>0</td>
</tr>
<tr>
<td></td>
<td> king          </td>
<td align="center"> 0   </td>
<td>1</td>
</tr>
<tr>
<td></td>
<td> fairy         </td>
<td align="center"> 1   </td>
<td>0</td>
</tr>
<tr>
<td></td>
<td> gold          </td>
<td align="center"> 1   </td>
<td>1</td>
</tr>
</tbody>
</table>


<p>The size of the matrix will be big enough to support hypervector behavior, but not so big as to make computation too annoyingly slow.  It will be nouns x 10,000.</p>

<p>The first task is to get a set of nouns to fill out the rows.  Although, there are numerous online sources for linguistic nouns, they unfortunately do not cover the same language spectrum as old fairy tale books.  So we are going to collect our own.  Using <a href="http://stanfordnlp.github.io/CoreNLP/">Stanford CoreNLP</a>, we can collect a set of nouns using Grimm&rsquo;s Book as a guide.  There are about 2500 nouns there to give us a nice sample to play with.  This makes our total matrix size ~ 2500 x 10,000.</p>

<p>Now that we have our nouns, let&rsquo;s get down to business.  We want to create an index to row to make a <code>noun-idx</code> and then create a sparse matrix for our word frequency matrix.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">hyperdimensional-playground.context-vectors</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.matrix</span> <span class="ss">:as</span> <span class="nv">m</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">clojure.core.matrix.linear</span> <span class="ss">:as</span> <span class="nv">ml</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">clojure.string</span> <span class="ss">:as</span> <span class="nv">string</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">hyperdimensional-playground.core</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">rand-hv</span> <span class="nv">cosine-sim</span> <span class="nv">mean-add</span> <span class="nv">inverse</span> <span class="nv">xor-mul</span><span class="p">]]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">hyperdimensional-playground.fairytale-nouns</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">fairy-tales-nouns</span> <span class="nv">book-list</span><span class="p">]]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">m/set-current-implementation</span> <span class="ss">:vectorz</span><span class="p">)</span>
</span><span class='line'><span class="c1">;; size of the hypervectors and freq matrix columns</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">sz</span> <span class="mi">10000</span><span class="p">)</span>
</span><span class='line'><span class="c1">;; The nouns come from a sampling of Grimm&#39;s fairy tale nouns these will</span>
</span><span class='line'><span class="c1">;; make up the rows in the frequency matrix</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">noun-idx</span> <span class="p">(</span><span class="nb">zipmap </span><span class="nv">fairy-tales-nouns</span> <span class="p">(</span><span class="nf">range</span><span class="p">)))</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">freq-matrix</span> <span class="p">(</span><span class="nf">m/new-sparse-array</span> <span class="p">[(</span><span class="nb">count </span><span class="nv">fairy-tales-nouns</span><span class="p">)</span> <span class="nv">sz</span><span class="p">]))</span>
</span></code></pre></td></tr></table></div></figure>


<p>The next thing we need to do is to have some functions to take a book, read it in, split it into documents and then update the frequency matrix.</p>

<h3>Random indexing for the win</h3>

<p>The interesting thing about the update method is that we can use <em>random indexing</em>.  We don&rsquo;t need to worry about having a column for each document.  Because of the nature of hyperdimensions, we can randomly assign 10 columns for each document.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">update-doc!</span>
</span><span class='line'>  <span class="s">&quot;Given a document - upate the frequency matrix using random indexing&quot;</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">doc</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">known-nouns</span> <span class="p">(</span><span class="nf">clojure.set/intersection</span> <span class="nv">fairy-tales-nouns</span> <span class="p">(</span><span class="nb">set </span><span class="nv">doc</span><span class="p">))]</span>
</span><span class='line'>    <span class="c1">; use positive random indexing</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">doall </span><span class="p">(</span><span class="nf">repeatedly</span> <span class="mi">10</span> <span class="o">#</span><span class="p">(</span><span class="nb">doseq </span><span class="p">[</span><span class="nv">noun</span> <span class="nv">known-nouns</span><span class="p">]</span>
</span><span class='line'>                       <span class="p">(</span><span class="nf">m/mset!</span> <span class="nv">freq-matrix</span> <span class="p">(</span><span class="nb">get </span><span class="nv">noun-idx</span> <span class="nv">noun</span><span class="p">)</span> <span class="p">(</span><span class="nb">rand-int </span><span class="nv">sz</span><span class="p">)</span> <span class="mi">1</span><span class="p">))))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>The whole book is processed by slurping in the contents and using a regex to split it up into docs to update the matrix.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">process-book</span>
</span><span class='line'>  <span class="s">&quot;Load a book and break it into sentence like documents and update the frequency matrix&quot;</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">book-str</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">book-text</span> <span class="p">(</span><span class="nb">slurp </span><span class="nv">book-str</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">docs</span> <span class="p">(</span><span class="nf">partition</span> <span class="mi">25</span> <span class="p">(</span><span class="nb">map </span><span class="nv">string/lower-case</span>
</span><span class='line'>                                <span class="p">(</span><span class="nf">string/split</span> <span class="nv">book-text</span> <span class="o">#</span><span class="s">&quot;\s|\.|\,|\;|\!|\?&quot;</span><span class="p">)))</span>
</span><span class='line'>        <span class="nv">doc-count</span> <span class="p">(</span><span class="nb">count </span><span class="nv">docs</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">println </span><span class="s">&quot;processing:&quot;</span> <span class="nv">book-str</span> <span class="s">&quot;(with&quot;</span> <span class="nv">doc-count</span> <span class="s">&quot;docs)&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">doall </span><span class="p">(</span><span class="nf">map-indexed</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">idx</span> <span class="nv">doc</span><span class="p">]</span>
</span><span class='line'>                          <span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nb">zero? </span><span class="p">(</span><span class="nf">mod</span> <span class="nv">idx</span> <span class="mi">1000</span><span class="p">))</span> <span class="p">(</span><span class="nb">println </span><span class="s">&quot;doc:&quot;</span> <span class="nv">idx</span><span class="p">))</span>
</span><span class='line'>                          <span class="p">(</span><span class="nf">update-doc!</span> <span class="nv">doc</span><span class="p">))</span>
</span><span class='line'>                        <span class="nv">docs</span><span class="p">))</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">println </span><span class="s">&quot;DONE with &quot;</span> <span class="nv">book-str</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can now run the whole processing with:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nb">doseq </span><span class="p">[</span><span class="nv">book</span> <span class="nv">book-list</span><span class="p">]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">process-book</span> <span class="nv">book</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>On my system, it only takes about 3 seconds.</p>

<p>Great!  Now we have hypervectors associated with word frequencies.  They are now <em>context word vectors</em>.  What can we do with them.</p>

<h3>How close is a king to a goat?</h3>

<p>One of the things that we can do with them is find out a measure of how closely related the context of two words are by a measure of their cosine similarity.  First, we need a handy function to turn a string word into a word vector by getting it out of our frequency matrix.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">wv</span> <span class="p">[</span><span class="nv">word</span><span class="p">]</span>
</span><span class='line'>  <span class="s">&quot;Get a hypervector for the word from the frequency matrix&quot;</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">i</span> <span class="p">(</span><span class="nb">get </span><span class="nv">noun-idx</span> <span class="nv">word</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">assert </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">nil? </span><span class="nv">i</span><span class="p">))</span> <span class="p">(</span><span class="nb">str </span><span class="nv">word</span> <span class="s">&quot; not found&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">m/slice</span> <span class="nv">freq-matrix</span> <span class="nv">i</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then we can make another nice function to compare two words and give a informational map back.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">compare-wvs</span>
</span><span class='line'>  <span class="s">&quot;Compare two words and give the cosine distance info map&quot;</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">word1</span> <span class="nv">word2</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">wv1</span> <span class="p">(</span><span class="nf">wv</span> <span class="nv">word1</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">wv2</span> <span class="p">(</span><span class="nf">wv</span> <span class="nv">word2</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nb">not= </span><span class="nv">word1</span> <span class="nv">word2</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span><span class="ss">:word1</span> <span class="nv">word1</span>
</span><span class='line'>       <span class="ss">:word2</span> <span class="nv">word2</span>
</span><span class='line'>       <span class="ss">:cosine</span> <span class="p">(</span><span class="nf">cosine-sim</span> <span class="nv">wv1</span> <span class="nv">wv2</span><span class="p">)})))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s take a look at the similarities of some words to <em>king</em>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nb">sort-by </span><span class="ss">:cosine</span><span class="p">[(</span><span class="nf">compare-wvs</span> <span class="s">&quot;king&quot;</span> <span class="s">&quot;queen&quot;</span><span class="p">)</span>
</span><span class='line'>                 <span class="p">(</span><span class="nf">compare-wvs</span> <span class="s">&quot;king&quot;</span> <span class="s">&quot;prince&quot;</span><span class="p">)</span>
</span><span class='line'>                 <span class="p">(</span><span class="nf">compare-wvs</span> <span class="s">&quot;king&quot;</span> <span class="s">&quot;princess&quot;</span><span class="p">)</span>
</span><span class='line'>                 <span class="p">(</span><span class="nf">compare-wvs</span> <span class="s">&quot;king&quot;</span> <span class="s">&quot;guard&quot;</span><span class="p">)</span>
</span><span class='line'>                 <span class="p">(</span><span class="nf">compare-wvs</span> <span class="s">&quot;king&quot;</span> <span class="s">&quot;goat&quot;</span><span class="p">)])</span>
</span><span class='line'>  <span class="c1">;; ({:word1 &quot;king&quot;, :word2 &quot;goat&quot;, :cosine 0.1509151478896664}</span>
</span><span class='line'>  <span class="c1">;;  {:word1 &quot;king&quot;, :word2 &quot;guard&quot;, :cosine 0.16098893367403827}</span>
</span><span class='line'>  <span class="c1">;;  {:word1 &quot;king&quot;, :word2 &quot;queen&quot;, :cosine 0.49470535530616655}</span>
</span><span class='line'>  <span class="c1">;;  {:word1 &quot;king&quot;, :word2 &quot;prince&quot;, :cosine 0.5832521795716931}</span>
</span><span class='line'>  <span class="c1">;;  {:word1 &quot;king&quot;, :word2 &quot;princess&quot;, :cosine 0.5836922474743367})</span>
</span></code></pre></td></tr></table></div></figure>


<p>As expected, the royal family is closer to the king then a guard or goat is.</p>

<p>One of the interesting things is that now we can do addition and subtraction with these word vectors and see how it affects the relation with other words.</p>

<h3>Boy + Gold = King, Boy + Giant = Jack</h3>

<p>We can take a look at how close <em>boy</em> and <em>king</em> are together by themselves.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">cosine-sim</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;boy&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;king&quot;</span><span class="p">))</span> <span class="c1">;=&gt; 0.42996397142253145</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can add some gold to the boy and that new word vector will be closer to king than boy was alone.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">cosine-sim</span> <span class="p">(</span><span class="nf">mean-add</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;boy&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;gold&quot;</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;king&quot;</span><span class="p">))</span> <span class="c1">;=&gt; 0.5876251031366048</span>
</span></code></pre></td></tr></table></div></figure>


<p>Doing the same for <em>boy</em> and <em>jack</em>, we find that adding a giant moves the context closer.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">cosine-sim</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;boy&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;jack&quot;</span><span class="p">))</span> <span class="c1">;=&gt; 0.33102858702785953</span>
</span><span class='line'><span class="c1">;; boy + giant = jack</span>
</span><span class='line'><span class="p">(</span><span class="nf">cosine-sim</span> <span class="p">(</span><span class="nf">mean-add</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;giant&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;boy&quot;</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;jack&quot;</span><span class="p">))</span> <span class="c1">;=&gt;0.4491473187787431</span>
</span></code></pre></td></tr></table></div></figure>


<p>Amusingly, a frog and a princess make a prince.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="c1">;;; frog + princess = prince</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">cosine-sim</span> <span class="p">(</span><span class="nf">wv-add</span> <span class="s">&quot;frog&quot;</span> <span class="s">&quot;princess&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;prince&quot;</span><span class="p">))</span> <span class="c1">;=&gt; 0.5231641991974249</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can take this even farther by subtracting words and adding others.  For example a similarity to the word queen can be obtained by subtracting man from king and adding woman.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="c1">;;; queen= (king-man) + woman</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">cosine-sim</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;queen&quot;</span><span class="p">)</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">mean-add</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;woman&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv-subtract</span> <span class="s">&quot;king&quot;</span> <span class="s">&quot;man&quot;</span><span class="p">)))</span> <span class="c1">;=&gt;0.5659832204544486</span>
</span></code></pre></td></tr></table></div></figure>


<p>Similarly, a contextual closeness to father can be gotten from subtracting woman from mother and adding man.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">cosine-sim</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;father&quot;</span><span class="p">)</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">mean-add</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;man&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv-subtract</span> <span class="s">&quot;mother&quot;</span> <span class="s">&quot;woman&quot;</span><span class="p">)))</span> <span class="c1">;=&gt;0.5959841177719538</span>
</span></code></pre></td></tr></table></div></figure>


<p>But wait, that&rsquo;s not all.  We can also do express facts with these word vectors and <em>reason</em> about them.</p>

<h3>Reasoning with word vector with the database as a hyperdimensional value</h3>

<p>The curious nature of hypervectors allows the storage of multiple entity, attributes in it and allow the retrieval of the likeness of them later by simple linear math &ndash; using only xor multiplication and addition.  This gives us the <em>database as a value</em> in the form of a high dimensional vector.</p>

<p>For an example, say we want to express the fact that Hansel is a brother of Gretel.  We can do this by adding the xor product of brother with hansel and the product of brother with Gretel.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="c1">;; hansel is the brother of gretel</span>
</span><span class='line'><span class="c1">;; B*H + B*G</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">hansel-brother-of-gretel</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">mean-add</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">xor-mul</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;brother&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;hansel&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">xor-mul</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;brother&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;gretel&quot;</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Also we can express that Jack is a brother of Hansel.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">jack-brother-of-hansel</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">mean-add</span>
</span><span class='line'>     <span class="p">(</span><span class="nf">xor-mul</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;brother&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;jack&quot;</span><span class="p">))</span>
</span><span class='line'>     <span class="p">(</span><span class="nf">xor-mul</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;brother&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;hansel&quot;</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can add these two facts together to make a new hypervector value.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">facts</span> <span class="p">(</span><span class="nf">mean-add</span> <span class="nv">hansel-brother-of-gretel</span>
</span><span class='line'>                       <span class="nv">jack-brother-of-hansel</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can actually <em>reason</em> about them and ask questions.  Is Jack a brother of Hansel?  With a high cosine similarity, we can assume the answer is likely.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'> <span class="c1">;; is jack the brother of hansel?</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">cosine-sim</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;jack&quot;</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">xor-mul</span> <span class="p">(</span><span class="nf">mean-add</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;brother&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;gretel&quot;</span><span class="p">))</span>
</span><span class='line'>            <span class="nv">facts</span><span class="p">))</span> <span class="c1">;=&gt;0.8095270629815969</span>
</span></code></pre></td></tr></table></div></figure>


<p>What about someone unrelated.  Is Cinderella the brother of Gretel? &ndash; No</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'> <span class="c1">;; is cinderella the brother of gretel ?</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">cosine-sim</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;cinderella&quot;</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">xor-mul</span> <span class="p">(</span><span class="nf">mean-add</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;brother&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;gretel&quot;</span><span class="p">))</span>
</span><span class='line'>            <span class="nv">facts</span><span class="p">))</span> <span class="c1">;=&gt;0.1451799916656951</span>
</span></code></pre></td></tr></table></div></figure>


<p>Is Jack the brother of Gretel &ndash; Yes</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'> <span class="c1">;; is jack the brother of gretel ?</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">cosine-sim</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;jack&quot;</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">xor-mul</span> <span class="p">(</span><span class="nf">mean-add</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;brother&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;gretel&quot;</span><span class="p">))</span>
</span><span class='line'>            <span class="nv">facts</span><span class="p">))</span> <span class="c1">;=&gt; 0.8095270629815969</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can take this further by adding more facts and inventing a relation of our own.</p>

<h3>Siblings in Hyperspace</h3>

<p>Let&rsquo;s invent a new word vector that is not in our nouns &ndash; <em>siblings</em>.  We are going to create new random hypervector to represent it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">siblings</span> <span class="p">(</span><span class="nf">rand-hv</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We will define it in terms of word vectors that we already have.  That is, siblings will be a the sum of brother + sister.  We XOR multiply it by siblings to associate it with the hypervector.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">siblings-brother-sister</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">mean-add</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">siblings</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;brother&quot;</span><span class="p">))</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">siblings</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;sister&quot;</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can add some more facts.  Gretel is a sister of Hansel.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'> <span class="c1">;; gretel is the sister of hansel</span>
</span><span class='line'>  <span class="c1">;; S*G + S*H</span>
</span><span class='line'>  <span class="p">(</span><span class="k">def </span><span class="nv">gretel-sister-of-hansel</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">mean-add</span>
</span><span class='line'>     <span class="p">(</span><span class="nf">xor-mul</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;sister&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;gretel&quot;</span><span class="p">))</span>
</span><span class='line'>     <span class="p">(</span><span class="nf">xor-mul</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;sister&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;hansel&quot;</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Gretel is also a sister of Jack.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'>  <span class="c1">;; gretel is the sister of jack</span>
</span><span class='line'>  <span class="c1">; S*G + S*H</span>
</span><span class='line'>  <span class="p">(</span><span class="k">def </span><span class="nv">gretel-sister-of-jack</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">mean-add</span>
</span><span class='line'>     <span class="p">(</span><span class="nf">xor-mul</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;sister&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;gretel&quot;</span><span class="p">))</span>
</span><span class='line'>     <span class="p">(</span><span class="nf">xor-mul</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;sister&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;jack&quot;</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Collecting all of our facts into one hypervector (as a database).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'> <span class="p">(</span><span class="k">def </span><span class="nv">facts</span> <span class="p">(</span><span class="nf">mean-add</span> <span class="nv">hansel-brother-of-gretel</span>
</span><span class='line'>                       <span class="nv">jack-brother-of-hansel</span>
</span><span class='line'>                       <span class="nv">gretel-sister-of-jack</span>
</span><span class='line'>                       <span class="nv">gretel-sister-of-hansel</span>
</span><span class='line'>                       <span class="nv">siblings-brother-sister</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can ask some for questions.</p>

<p>Are Hansel and Gretel siblings? &ndash; Yes</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="c1">;; are hansel and gretel siblings?</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">cosine-sim</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">mean-add</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;hansel&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;gretel&quot;</span><span class="p">))</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">siblings</span> <span class="nv">facts</span><span class="p">))</span> <span class="c1">;=&gt;0.627015379034067</span>
</span></code></pre></td></tr></table></div></figure>


<p>Are John and Roland siblings &ndash; No</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="c1">;; are john and roland siblings?</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">cosine-sim</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">mean-add</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;roland&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;john&quot;</span><span class="p">))</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">siblings</span> <span class="nv">facts</span><span class="p">))</span> <span class="c1">;=&gt; 0.1984017637065277</span>
</span></code></pre></td></tr></table></div></figure>


<p>Are Jack and Hansel siblings? &ndash; Yes</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'>  <span class="p">(</span><span class="nf">cosine-sim</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">mean-add</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;jack&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">wv</span> <span class="s">&quot;hansel&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">siblings</span> <span class="nv">facts</span><span class="p">))</span> <span class="c1">;=&gt;0.48003572523507465</span>
</span></code></pre></td></tr></table></div></figure>


<p>It is interesting to think of that nothing is stopping us at this point from <em>retracting</em> facts by simply subtracting the fact encoded word vectors from our &ldquo;database&rdquo; value and making a new value from it.</p>

<h3>Conclusions</h3>

<p>In this fun, but casual exploration of word vector we have seen the potential for reasoning about language in a way that uses nothing more complicated than addition and multiplication.  The ability to store dense information in hypervectors, extract it with simple methods, and flexibly collect it randomly, shows its versatility and power.  Hyperdimensional vectors  might hold the key to unlocking a deeper understanding of cognitive computing or perhaps even true artificial intelligence.</p>

<p>It is interesting to note that this technique is not limited to words. Other applications can be done the same way.  For example a video recommendation using a hypervector with movie titles.  Or perhaps even anomaly detection using sensor readings over a regular weekly time period.</p>

<p>Looking over our journey with word vectors.  At the beginning it seemed that word vectors were magical.  Now, after an understanding of the basics, it still seems like magic.</p>

<p>If you are interested in exploring further, feel free to use my github <a href="https://github.com/gigasquid/hyperdimensional-playground">hyperdimensional-playground</a> as a starting point.</p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2016/02/10/fairy-tale-word-vectors//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/02/06/why-hyperdimensional-socks-never-match/">
		
			Why Hyperdimensional Socks Never Match</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2016-02-06T14:26:00-05:00" pubdate data-updated="true">Feb 6<span>th</span>, 2016</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>, <a class='category' href='/blog/categories/clojure/'>Clojure</a>


</div>
    </div>
		<p><img src="http://c2.staticflickr.com/8/7238/7188420611_a99f936971_n.jpg"></p>

<p>The nature of computing in hyperdimensions is a strange and wonderful place.   I have only started to scratch the surface by reading a paper by <a href="http://redwood.berkeley.edu/pkanerva/papers/kanerva09-hyperdimensional.pdf">Kanerva</a>. Not only is it interesting from a computer science standpoint, it&rsquo;s also interesting from a cognitive science point of view.  In fact, it could hold the key to better model AI and general reasoning.  This blog is a casual stroll through some of the main points of Kanerva&rsquo;s paper along with examples in Clojure to make it tangible.  First things first, what is a hyperdimension?</p>

<h3>What is a Hyperdimension and Where Are My Socks?</h3>

<p>When we are talking about hyperdimensions, we are really talking about <em>lots</em> of dimensions.  A vector has dimensions.  A regular vector could have three dimensions <code>[0 1 1]</code>, but a hyperdimensional vector has tons more, like 10,000 or 100,000.  We call these big vectors <em>hypervectors</em> for short, which makes them sound really cool. Although the vectors could be made up of anything, we are going to use vectors made up of zeros and ones.  To handle big computing with big vectors in a reasonable amount of time, we are also going to use <em>sparse</em> vectors.  What makes them sparse is that most of the space is empty, (zeros).  In fact, Clojure has a nice library to handle these sparse vectors.  The <a href="https://github.com/mikera/core.matrix">core.matrix</a> project from Mike Anderson is what we will use in our examples.  Let&rsquo;s go ahead and make some random hypervectors.</p>

<p>First we import the core.matrix libraries and set the implementation to vectorz which provides fast double precision vector math.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">hyperdimensional-playground.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.core.matrix</span> <span class="ss">:as</span> <span class="nv">m</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">clojure.core.matrix.linear</span> <span class="ss">:as</span> <span class="nv">ml</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">m/set-current-implementation</span> <span class="ss">:vectorz</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next we set the sz of our hypervectors to be 100,000.  We also create a function to generate a random sparse hypervector by choosing to put ones in about 10% of the space.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">sz</span> <span class="mi">100000</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">rand-hv</span> <span class="p">[]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">hv</span> <span class="p">(</span><span class="nf">m/new-sparse-array</span> <span class="p">[</span><span class="nv">sz</span><span class="p">])</span>
</span><span class='line'>        <span class="nv">n</span> <span class="p">(</span><span class="nb">* </span><span class="mf">0.1</span> <span class="nv">sz</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">dotimes </span><span class="p">[</span><span class="nv">i</span> <span class="nv">n</span><span class="p">]</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">m/mset!</span> <span class="nv">hv</span> <span class="p">(</span><span class="nb">rand-int </span><span class="nv">sz</span><span class="p">)</span> <span class="mi">1</span><span class="p">))</span>
</span><span class='line'>    <span class="nv">hv</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can generate some.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">a</span> <span class="p">(</span><span class="nf">rand-hv</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">b</span> <span class="p">(</span><span class="nf">rand-hv</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">c</span> <span class="p">(</span><span class="nf">rand-hv</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">d</span> <span class="p">(</span><span class="nf">rand-hv</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="nv">a</span> <span class="c1">;=&gt; #vectorz/vector Large vector with shape: [100000]</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can think of each of this hypervectors as random hyperdimensional sock, or hypersock, because that sounds cooler.  These hypersocks, have curious properties.  One of which is that they will ~never match.</p>

<h3>Hypersocks never match</h3>

<p>Because we are dealing with huge amount of dimensions, a mathematically peculiar probability distribution occurs.  We can take a random hypervector to represent something, then take another one and they will different from each by about 100 STD. We can take another one and it too, will be 100 STD from the other ones.  For practical purposes, we will run out of time before we will run of vectors that are unrelated.  Because of this, any two hypersocks will never match each other.</p>

<p>How can we tell how similar two hypersocks are?  The cosine to tell the similarity between two vectors.  This is determined by the dot product.  We can construct a <a href="https://en.wikipedia.org/wiki/Cosine_similarity">cosine similarity</a> function to give us a value from -1 to 1 to measure how alike they are with 1 being the same and -1 being the complete opposite.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">cosine-sim</span> <span class="p">[</span><span class="nv">v1</span> <span class="nv">v2</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">m/dot</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
</span><span class='line'>     <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">ml/norm</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">ml/norm</span> <span class="nv">v2</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>If we look at the similarity of a hypervector with itself, the result is ~1.  With the other random hypervectors, it is ~0.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">cosine-sim</span> <span class="nv">a</span> <span class="nv">a</span><span class="p">)</span> <span class="c1">;=&gt;  1.0</span>
</span><span class='line'><span class="p">(</span><span class="nf">cosine-sim</span> <span class="nv">d</span> <span class="nv">d</span><span class="p">)</span> <span class="c1">;=&gt; 1.0</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">cosine-sim</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span> <span class="c1">;=&gt;  0.0859992468320239</span>
</span><span class='line'><span class="p">(</span><span class="nf">cosine-sim</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="c1">;=&gt; 0.09329186588790261</span>
</span><span class='line'><span class="p">(</span><span class="nf">cosine-sim</span> <span class="nv">a</span> <span class="nv">c</span><span class="p">)</span> <span class="c1">;=&gt; 0.08782018973001954</span>
</span></code></pre></td></tr></table></div></figure>


<p>There are other cool things we can do with hypervectors, like do math with them.</p>

<h3>The Hamming Distance of Two Hypersocks</h3>

<p>We can add hypervectors together with a sum mean vector. We add the vector of 1s and 0s together then we divide the resulting vector by the number of total vectors.  Finally, to get back to our 1s and 0s, we round the result.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">mean-add</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">hvs</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">m/emap</span> <span class="o">#</span><span class="p">(</span><span class="nf">Math/round</span> <span class="p">(</span><span class="nb">double </span><span class="nv">%</span><span class="p">))</span>
</span><span class='line'>   <span class="p">(</span><span class="nf">m/div</span> <span class="p">(</span><span class="nb">apply </span><span class="nv">m/add</span> <span class="nv">hvs</span><span class="p">)</span> <span class="p">(</span><span class="nb">count </span><span class="nv">hvs</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>The interesting thing about addition is that the result is similar to all the vectors in it.  For example, if we add a and b together to make x, <code>x = a + b</code>, then x will be similar to a and similar to b.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="c1">;; x = a + b</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">x</span> <span class="p">(</span><span class="nf">mean-add</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nf">cosine-sim</span> <span class="nv">x</span> <span class="nv">a</span><span class="p">)</span> <span class="c1">;=&gt; 0.7234734658023224</span>
</span><span class='line'><span class="p">(</span><span class="nf">cosine-sim</span> <span class="nv">x</span> <span class="nv">b</span><span class="p">)</span> <span class="c1">;=&gt; 0.7252586504505658</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can also do a very simple form of multiplication on vectors with 1s and 0s with using <em>XOR</em>.  We can do this by add the two vectors together and then mapping <code>mod 2</code> on each of the elements.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">xor-mul</span> <span class="p">[</span><span class="nv">v1</span> <span class="nv">v2</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="p">(</span><span class="nf">m/add</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">m/emap</span> <span class="o">#</span><span class="p">(</span><span class="nf">mod</span> <span class="nv">%</span> <span class="mi">2</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can actually use this <code>xor-mul</code> to calculate the <a href="https://en.wikipedia.org/wiki/Hamming_distance">Hamming distance</a>, which is an important measure of error detection.  The Hamming distance is simply the sum of all of the xor multiplied elements.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">hamming-dist</span> <span class="p">[</span><span class="nv">v1</span> <span class="nv">v2</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">m/esum</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">hamming-dist</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">])</span> <span class="c1">;=&gt; 0</span>
</span><span class='line'><span class="p">(</span><span class="nf">hamming-dist</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">])</span> <span class="c1">;=&gt; 2</span>
</span><span class='line'><span class="p">(</span><span class="nf">hamming-dist</span> <span class="nv">a</span> <span class="nv">a</span><span class="p">)</span> <span class="c1">;=&gt; 0</span>
</span></code></pre></td></tr></table></div></figure>


<p>This illustrates a point that xor multiplication randomizes the hypervector, but preserves the distance.  In the following example, we xor multiply two random hypervectors by another and the hamming distance stays the same.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="c1">; xa = x * a</span>
</span><span class='line'><span class="c1">; ya = y * a</span>
</span><span class='line'><span class="c1">; hamming distance of xa is the same as ya</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">;; multiplication randomizes but preserves the distance</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">x</span> <span class="p">(</span><span class="nf">rand-hv</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">y</span> <span class="p">(</span><span class="nf">rand-hv</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">xa</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">x</span> <span class="nv">a</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">ya</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">y</span> <span class="nv">a</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nf">hamming-dist</span> <span class="nv">xa</span> <span class="nv">ya</span><span class="p">)</span> <span class="c1">;=&gt; 1740.0</span>
</span><span class='line'><span class="p">(</span><span class="nf">hamming-dist</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="c1">;=&gt; 1740.0</span>
</span></code></pre></td></tr></table></div></figure>


<p>So you can xor multiply your two hypersocks and move them to a different point in hyperspace, but they will still be the same distance apart.</p>

<p>Another great party trick in hyperspace, is the ability to bind and unbind hypervectors for use as map like pairs.</p>

<h3>Using Hypervectors to Represent Maps</h3>

<p>A map of pairs is a very important data structure.  It gives the ability to bind symbols to values and then retrieve those values.  We can do this with hypervectors too.  Consider the following structure:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:name</span> <span class="s">&quot;Gigasquid&quot;</span>
</span><span class='line'> <span class="ss">:cute-animal</span> <span class="s">&quot;duck&quot;</span>
</span><span class='line'> <span class="ss">:favorite-sock</span> <span class="s">&quot;red plaid&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can now create hypervectors to represent each of these values.  Then we can xor the hypervector symbol to the hypervector value and sum them up.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="c1">;; data records with bound pairs</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">x</span> <span class="p">(</span><span class="nf">rand-hv</span><span class="p">))</span> <span class="c1">;; favorite-sock</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">y</span> <span class="p">(</span><span class="nf">rand-hv</span><span class="p">))</span> <span class="c1">;; cute-animal</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">z</span> <span class="p">(</span><span class="nf">rand-hv</span><span class="p">))</span> <span class="c1">;; name</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">a</span> <span class="p">(</span><span class="nf">rand-hv</span><span class="p">))</span> <span class="c1">;; red-plaid</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">b</span> <span class="p">(</span><span class="nf">rand-hv</span><span class="p">))</span> <span class="c1">;; duck</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">c</span> <span class="p">(</span><span class="nf">rand-hv</span><span class="p">))</span> <span class="c1">;; gigasquid</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;H = X * A + Y * B + Z * C</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">h</span> <span class="p">(</span><span class="nf">mean-add</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">x</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">y</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">z</span> <span class="nv">c</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, we have a sum of all these things and we want to find the value of the <em>favorite sock</em>.  We can <em>unbind</em> it from the sum by xor multiplying the favorite-sock hypervector <code>x</code>.  Because of the property that xor multiplication both distributes and cancels itself out.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">hamming-dist</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">x</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">x</span> <span class="nv">a</span><span class="p">))</span> <span class="nv">a</span><span class="p">)</span> <span class="c1">;=&gt; 0</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can compare the result with the known values and find the closest match.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">hamming-dist</span> <span class="nv">a</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">x</span> <span class="nv">h</span><span class="p">))</span> <span class="c1">;=&gt; 1462.0  ;; closest to &quot;red-plaid&quot;</span>
</span><span class='line'><span class="p">(</span><span class="nf">hamming-dist</span> <span class="nv">b</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">x</span> <span class="nv">h</span><span class="p">))</span> <span class="c1">;=&gt; 1721.0</span>
</span><span class='line'><span class="p">(</span><span class="nf">hamming-dist</span> <span class="nv">c</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">x</span> <span class="nv">h</span><span class="p">))</span> <span class="c1">;=&gt; 1736.0</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">cosine-sim</span> <span class="nv">a</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">x</span> <span class="nv">h</span><span class="p">))</span> <span class="c1">;=&gt; 0.3195059768353112 ;; closest to &quot;red-plaid&quot;</span>
</span><span class='line'><span class="p">(</span><span class="nf">cosine-sim</span> <span class="nv">b</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">x</span> <span class="nv">h</span><span class="p">))</span> <span class="c1">;=&gt; 0.1989075567830733</span>
</span><span class='line'><span class="p">(</span><span class="nf">cosine-sim</span> <span class="nv">c</span> <span class="p">(</span><span class="nf">xor-mul</span> <span class="nv">x</span> <span class="nv">h</span><span class="p">))</span> <span class="c1">;=&gt; 0.18705233578983288</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Conclusion</h3>

<p>We have seen that the nature of higher dimensional representation leads to some very interesting properties with both representing data and computing with it.  These properties and others form the foundation of exciting advancements in Cognitive Computing like word vectors.  Future posts will delve further into these interesting areas.  In the meantime, I encourage you to read Kanerva&rsquo;s paper on your own and to find comfort in that when you can&rsquo;t find one of your socks, it&rsquo;s not your fault. It most likely has something to do with the curious nature of hyperspace.</p>

<p><em>Thanks to <a href="https://twitter.com/ross_gayler">Ross Gayler</a> for bringing the paper to my attention and to <a href="https://twitter.com/solussd">Joe Smith</a> for the great conversations on SDM</em></p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2016/02/06/why-hyperdimensional-socks-never-match//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/01/16/book-of-software-miracles/">
		
			Book of Software Miracles</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2016-01-16T22:09:00-05:00" pubdate data-updated="true">Jan 16<span>th</span>, 2016</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>


</div>
    </div>
		<p><img src="http://c2.staticflickr.com/2/1611/23811303563_029d4c864e_c.jpg" title="&#34;Book of Software Miracles - Cover&#34;" alt="&#34;Book of Software Miracles - Cover&#34;"></p>

<p>This 21st century illustrated manuscript was recently uncovered.  It depicts miraculous phenomena in software engineering and represents one of the most spectacular new discoveries in the field of Renaissance Computer Science.</p>

<p>Some examples of the glorious illustrations and text translations are presented here.</p>

<p><img src="http://c2.staticflickr.com/2/1520/24070311299_c23fc388e0_z.jpg" title="&#34;Book of Software Miracles Fol. 26&#34;" alt="&#34;Book of Software Miracles Fol. 26&#34;"></p>

<p><em>On the day in 1958 that John McCarthy invented LISP, three suns appeared in the East in the morning sky which moved towards each other so that they merged into one.</em></p>

<p><img src="http://c2.staticflickr.com/2/1448/24355655351_f449746e80_z.jpg" title="&#34;Book of Software Miracles Fol. 72&#34;" alt="&#34;Book of Software Miracles Fol. 72&#34;"></p>

<p><em>In the year 1952, countless software bugs appeared in the land after being coined by Grace Hopper during the invention of the COBOL language.</em></p>

<p><img src="http://c2.staticflickr.com/2/1644/23809895144_dac1fdcc2c_z.jpg" title="&#34;Book of Software Miracles Fol. 83&#34;" alt="&#34;Book of Software Miracles Fol. 83&#34;"></p>

<p><em>In the year of 2007, a great and wonderful comet appeared in the sky.  This was followed by the invention of the Clojure language by Rich Hickey.</em></p>

<p><img src="http://c2.staticflickr.com/2/1704/24070310299_c9b80e4033_z.jpg" title="&#34;Book of Software Miracles Fol. 91&#34;" alt="&#34;Book of Software Miracles Fol. 91&#34;"></p>

<p><em>A month after the NPM Node repository burst its banks in the year of 2015, a wondrous creature appeared from the JavaScript ecosystem.  Found dead after the raging subsided, was in this shape and form and is painted here.</em></p>

<p>For more information about this remarkable book visit <a href="http://www.taschen.com/pages/en/catalogue/classics/all/03107/facts.the_book_of_miracles.htm">Book of Software Miracles</a></p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2016/01/16/book-of-software-miracles//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/12/20/can-a-programming-language-make-you-smarter/">
		
			Can a Programming Language Make You Smarter?</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2015-12-20T11:16:00-05:00" pubdate data-updated="true">Dec 20<span>th</span>, 2015</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>


</div>
    </div>
		<p><img src="http://c1.staticflickr.com/1/34/118425909_86f332f075_z.jpg?zz=1"></p>

<p>All programming languages are not created equal.  Some clearly excel at solving different problems.  There are languages that are great for scalability and others that are great for proving correctness.  But what about one that that will make you smarter?  To look for this answer, I am going to turn to a different language, our human language, and research from the field of linguistics and cognitive development.</p>

<h3>A new language is born</h3>

<p>Up until the late 1970s, there was no school for the deaf In Nicaragua.  Being deaf before then meant only developing crude signs with your family and friends.  Beyond that there was nothing.  Finally, the wife of the dictator set up a special school for them.  This was the first time that the children were brought together in one place rather than being scattered about.  For most of them, it was the first time that they had ever met another deaf person.  There were about fifty kids in that first class and they came together with fifty different ways of communication with crude gestures.  But after awhile, something amazing happened. They started to converge into a common system &ndash; a language was born. For scientists, this was an incredible opportunity to watch a new language develop.  One of the fascinating insights had to do with how the this sign language evolved over the generations of children entering the school.  One in particular, was a study about how words in a language can actually increase your cognitive capacity and make people <em>smarter</em>.</p>

<p>The study involved a test that was performed on different generations of students from the school, including the very first students who were now grown and younger children.  A comic strip shown to the participants. In it there are two brothers.  The big brother is playing with the train and the little brother wants the play with it.  The big brother puts it under the bed and goes out to the kitchen to get a sandwich.  While the big brother is gone, the little brother takes out the train and hides it in the toy box.  The question for the test subjects is, &ldquo;When the big brother comes back, where is he going to look for the train?&rdquo;</p>

<h3>Thinking about thinking</h3>

<p>For most kids over the age of five, the answer will be that the big brother will look under the bed because he doesn&rsquo;t know that it has been moved to the toy box.  The interesting thing was that the first generation of kids that went through the school, now thirty five years old, failed this simple test.  The younger ones all passed.  What was going on?</p>

<p>To find out, the scientists looked a differences in the language over the generations and found that the older signers lacked words for the concept of thinking.  The earlier generation just had one word for <em>think</em>, while the later generations had evolved ten or twelve.  Words that expressed concepts like <em>understand</em> and <em>believe</em>.  It seems that having words gave them access to a concept that otherwise would have been really hard to think about.  It increased their cognitive capacity.  It enabled them to <em>think about thinking</em>.</p>

<h3>Thinking about programming programs</h3>

<p>Programming languages allow us to translate our human thoughts and instructions to machines.  We have words to express simple concepts like adding two numbers together with <code>+</code> or finding how many elements are in a list with <code>count</code>, but what about harder concepts that are more difficult to access?  Is there an analogy to having words to <em>think about thinking</em> that some programming languages have that others don&rsquo;t?  I believe there is.  It&rsquo;s having a way to think about a <em>program programming itself</em> with self modifying code or <em>macros</em>.</p>

<p>In Clojure, macros are way to do <em>meta-programming</em>.  This involves ability to treat the program as data, allowing a program to modify another program &ndash; even its own.  It gives Clojure the capability to implement language features, make code more concise, and encapsulate patterns and repetitive code.  It is a powerful feature and more to the point of our current line of inquiry, it is a pretty friggin difficult concept to grok.  In fact, before I was exposed to a language that had macros in it, I doubt that I would have been able to think about it.  For the sake of argument, let&rsquo;s go back to the comic strip story with the two brothers.  But this time, the train is a function and the little brother uses a macro on it when the big brother gets a snack in the kitchen.  What does the big brother expect the result of the program to be when he gets back in the room.  Prior to my exposure to Clojure and macros, I am sure I would have failed the test.</p>

<h3>Conclusion</h3>

<p>So yes, I do think that a programming language can increase your cognitive capacity and make you smarter.  I certainly feel that my exposure had expanded my world and given me access to programming concepts that I did not have with my other programming experience.  I also feel certain that there are other languages out there, both existing and yet to be invented, that have words to express concepts that am not even aware of.  Languages that are just waiting for me to expand my horizons.</p>

<p>And that certainty makes me incredibly happy and grateful to be a programmer.</p>

<p><em>Listen to whole fascinating story of Ann Senghas studying sign language that born in Nicaragua on <a href="http://www.radiolab.org/story/91730-new-words-new-world/">Radiolab</a></em></p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2015/12/20/can-a-programming-language-make-you-smarter//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/12/19/the-key-to-moving-fast-is-feedback/">
		
			The Key to Moving Fast Is Feedback</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2015-12-19T14:06:00-05:00" pubdate data-updated="true">Dec 19<span>th</span>, 2015</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>


</div>
    </div>
		<p><img src="http://c1.staticflickr.com/3/2205/1809288965_c84080f2d3_n.jpg"></p>

<p>The last time I went to the dentist to get a cavity filled, I got a shot of Novocain as a local anesthetic to numb the area.  After I emerged from the dental chair, I still had no feeling in my lip and mouth area.
Trying to talk and smile was comical.  Trying to drink tea resulting in dribbles down my face.  Luckily, the loss of feeling only lasted a couple hours.  Soon, I was back to normal.  Even in this small and common scenario, we can see the close link between motion and sensory perception.  What would happen if you couldn&rsquo;t feel your whole body?</p>

<p>This is exactly what happened in the tragic and amazing story of <a href="http://docuwiki.net/index.php?title=The_Man_who_Lost_his_Body">Ian Watermann</a>.  At age 19, he had what appeared to be the flu, but was actually a rare disease of the nervous system that left him unable to feel any sensation of touch below the neck.  Unable to process this sensory information, he was totally unable to walk or move his body.  This is despite the fact that his motor system was left almost untouched by the disease.  He had the capacity to move, but without the sensory feedback he was paralyzed.</p>

<p>Ian was told that he would spend the rest of his life in a wheelchair, but in an inspiring show of determination he recovered mobility.  With the help of physiotherapists, he retrained his brain to substitute visual feedback for touch feedback.  He could move his hands and legs while he could see them.  Finally, he could walk again with his sight and concentration.  If the visual feedback is taken away, (lights turned off), the ability to move vanishes.</p>

<p>Feedback is the essential ingredient for human motion.  But what about businesses, startups, and software projects?  One of the challenges that all of these face is the ability to <em>move</em> fast.  This ability to move is not unlike that in our own bodies.  Movement and action are a result of a complex, interdependent system.  In the case of businesses, they are made of people, technology, and processes.  Like the human body, it is critically dependent on feedback.   A business can have the capacity for action, but without the ability to process feedback it is essentially immobilized.</p>

<p>If you want to move fast, single most important thing you can do is to improve your feedback at every level.</p>

<p>If you want to add new technology, ask how it improves your feedback.</p>

<ul>
<li>Feedback from the market</li>
<li>Feedback from your users</li>
<li>Feedback from your operational systems</li>
<li>Feedback from your code</li>
<li>Feedback from your employees</li>
<li>Feedback from yourself</li>
</ul>


<p>The best feedback systems are distributed and multi-layered. A single market feedback signal to the CEO is good, but much better is one that gets shared among the many facets of a company.  A distributed and interconnected network of feedback will help companies and projects be responsive, fast, nimble, and resilient.</p>

<p>The next time you hear, &ldquo;How can we go faster&rdquo;?&ldquo; ask the question &#8220;How can we increase feedback?&rdquo;  You&rsquo;ll be on the right track to fly.</p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2015/12/19/the-key-to-moving-fast-is-feedback//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/12/08/gigasquids-radar-2015/">
		
			Gigasquid&#8217;s Radar 2015</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2015-12-08T17:36:00-05:00" pubdate data-updated="true">Dec 8<span>th</span>, 2015</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>


</div>
    </div>
		<p><img src="http://c1.staticflickr.com/1/627/23249736219_dfa625309b_c.jpg"></p>

<p>It&rsquo;s that time of the year again for <em>radars</em>.  Since I made <a href="http://gigasquidsoftware.com/blog/2014/12/17/gigasquids-radar-2014/">one last year</a>, I decided to continue the tradition and make one this year.</p>

<h2>Languages</h2>

<p>No changes from last year for Clojure and Pixie.</p>

<ul>
<li><em>Adopt</em>: Clojure &ndash; It is fantastic language.</li>
<li><em>Trial</em>: <a href="https://github.com/pixie-lang/pixie">Pixie</a> &ndash; The language continues to grow and improve and has a great community &ndash; and it is a LISP.</li>
<li><em>Assess</em>: <a href="http://elixir-lang.org/">Elixir</a> &ndash; Another great functional language leveraging the Erlang VM.   It has a lot of energy in the community.</li>
<li><em>Hold</em>: Java &ndash; There are plenty of other great alternatives out there on the JVM.</li>
</ul>


<h2>Cute Animals</h2>

<p>Alpacas have moved up from <em>trial</em> last year, and Llamas to <em>hold</em>.  Alpacas are clearly more fluffy.</p>

<ul>
<li><em>Adopt</em>: <a href="http://www.preciousanimals.com/wp-content/plugins/woo-tumblog/functions/thumb.php?src=wp-content/uploads/2012/03/Cute-Animals-4e41e26ba45d7.jpg&amp;w=530&amp;h=&amp;zc=1&amp;q=90">Alpacas</a> &ndash; Like llamas only fluffier.</li>
<li><em>Trial</em>: <a href="http://www.animalfactguide.com/wp-content/uploads/2013/08/quokka1.jpg">Quokkas</a> &ndash; Where does Australia get this <a href="https://en.wikipedia.org/wiki/Quokka">cutie</a>?</li>
<li><em>Assess</em>: <a href="http://apod.nasa.gov/apod/image/1303/tardigrade_eyeofscience_1024.jpg">Tardigrades &ndash; or Water Bear</a> &ndash; They are the cutest microscopic creature out there.</li>
<li><em>Hold</em>: <a href="http://www.llamas.org/imgs/corner.jpg">Llamas</a> &ndash; Not as fluffy as they could be.</li>
</ul>


<h2>Artificial Intelligence</h2>

<p>I haven&rsquo;t been too into robots this year, so the category has been changed to AI.</p>

<ul>
<li><em>Adopt</em>: <a href="http://www.cs.waikato.ac.nz/~ml/weka/">Weka</a> &ndash; A collection of machine learning algorithms and explorers.  I was very impressed with it when I tried it on a <a href="http://gigasquidsoftware.com/blog/2015/10/20/speech-act-classification-for-text-with-clojure/">speech acts classifier project</a>.</li>
<li><em>Trial</em>: <a href="http://deeplearning4j.org/word2vec.html">Word Vectors</a> &ndash; A way to encode words and leverage training so that you can see the relation between them.  For example, a dog is closer to the word wolf than cat.</li>
<li><em>Assess</em>: <a href="https://www.tensorflow.org/">Tensor Flow</a> &ndash; I have only scratched the surface with this, but it is an exciting open source computational pipeline for machine learning (and other things).  The tutorials are pretty amazing in quality alone.</li>
<li><em>Hold</em>: <a href="https://en.wikipedia.org/wiki/Inference#Automatic_logical_inference">Logical Inference</a> &ndash; This is pretty bold, but I base it on Professor Geoff Hinton&rsquo;s Deep Learning <a href="https://www.youtube.com/watch?v=IcOMKXAw5VA&amp;feature=youtu.be">talk</a> (at 33:00)  where he explains that thought vectors, (made from word vectors), will be able to perform natural reasoning with only linear algebra.  The grand dream of old fashioned strong AI, will then be realized in a completely different way.</li>
</ul>


<h2>Tasty Food</h2>

<ul>
<li><em>Adopt</em>: <a href="http://www.murrayscheese.com/media/catalog/product/cache/1/image/9df78eab33525d08d6e5fb8d27136e95/b/l/blue_stilton_colston_bassett.jpg">Stilton Cheese</a> &ndash; The king of cheeses.</li>
<li><em>Trial</em>: <a href="http://www.seriouseats.com/images/20100603-nibs-500.jpg">Cocoa Nibs</a> &ndash;  I have to admit I am getting into crunching on some nibs in the afternoon.  Best of all, no sugar!</li>
<li><em>Assess</em>: <a href="http://www.ahisushi.com/images/gallery/gallery-cold-sake.jpg">Cold Sake</a> &ndash; I was firmly in the warm sake camp, until I tried some very nice cold sakes.  However, in the winter, warm is so nice &hellip;</li>
<li><em>Hold</em>: <a href="https://cbshouston.files.wordpress.com/2012/12/fruitcake9.jpg?w=360">Fruit Cake</a> &ndash; Traditions are important, but sometimes you need to let it go.</li>
</ul>


<h3>Special Thanks</h3>

<p>The radar this year was generated by a cool <a href="https://github.com/thefourhorsemen/radar">github project</a> that uses Clojure and Quill to generate the image based off of a json config file.  So go out there and make a radar of your own.</p>

<p>Happy Holidays!</p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2015/12/08/gigasquids-radar-2015//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/10/20/speech-act-classification-for-text-with-clojure/">
		
			Speech Act Classification for Text With Clojure</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2015-10-20T13:11:00-04:00" pubdate data-updated="true">Oct 20<span>th</span>, 2015</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>, <a class='category' href='/blog/categories/clojure/'>Clojure</a>


</div>
    </div>
		<p>We humans are quite wonderful.  We do amazing things every day without even realizing it.  One of them, you are doing right now.  You are reading text.  Your brain is taking these jumbles of letters and spaces in this sentence, which in linguist terms is called an <a href="https://en.wikipedia.org/wiki/Utterance">utterance</a>, and making sense out of it.  The individual meanings of sentences might be quite complex.</p>

<p>Take for example the utterance, &ldquo;I like cheese&rdquo;.  To understand it properly, you need to know the meanings of the individual words.  In particular, you would need to know that cheese is a tasty food stuff that is made from milk.  This would be a detailed and full understanding.  But there is a higher level of understanding that we can look at called <a href="https://en.wikipedia.org/wiki/Utterance">Speech Acts</a>.</p>

<p>Speech Acts are way of classifying our communication according to purposes.  We perform speech acts when we ask questions, make statements, requests, promises, or even just say thanks.  These speech acts cross languages.  When I ask a question in English, it is the same speech act as if I ask it in French.  In fact, if we were to travel to another planet with aliens, we can assume if they had a language, it would involve speech acts.  It should be no surprise then, to communicate effectively with machines, it will have to understand speech acts.</p>

<p>To explore this communication we are going to consider only three speech acts:</p>

<ul>
<li>Statements &ndash; &ldquo;I like cheese.&rdquo;</li>
<li>Questions &ndash; &ldquo;How do you make cheese?&rdquo;</li>
<li>Expressives &ndash; &ldquo;Thank you&rdquo;</li>
</ul>


<p><em>Our goal is to have our program be able to tell the difference between these three speech acts &ndash; without punctuation.</em></p>

<p>Why not use punctuation?  If you are having a conversation with a human over Slack or some other chat channel, you may or may not put in a question mark or period.  To have a computer be able to converse as naturally with a human as another human, it will have to understand the speech act without the aid of punctuation.</p>

<p>Generally, we want to have the computer:</p>

<ol>
<li>Read in an utterance/text that may or may not have punctuation.</li>
<li>Classify whether the result is a statement, question, or expressive.</li>
</ol>


<p>To tackle this problem, we are going to have to break this up into two main parts.  The first is <em>parsing</em> the text and annotating it with data.  The second is to classify the text based on the data from the parsing.</p>

<h2>Parsing and Annotating Text with Stanford CoreNLP</h2>

<p>The <a href="http://nlp.stanford.edu/software/corenlp.shtml">Stanford CoreNLP</a> is considering the state of the art for POS, (Part of Speech), tagging and other linguistic annotations.  It also is a Java library, so very easy to use from Clojure.</p>

<p>Here we are using a simple wrapper library called <a href="https://github.com/gigasquid/stanford-talk">stanford-talk</a> to take in some text and process it.  The result is a list of <em>tokens</em> for each word in the <code>:token-data</code> map.  Each token is annotated with the POS tag.  There is a lot more data in the annotations that we can look at to give us insight into this text.  But, to keep things simple, we are just going to look at the POS speech tag at the moment.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">process-text</span> <span class="s">&quot;I like cheese&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;{:token-data</span>
</span><span class='line'><span class="c1">; ({:sent-num 0, :token &quot;I&quot;, :pos &quot;PRP&quot;, :net &quot;O&quot;, :lemma &quot;I&quot;, :sentiment &quot;Neutral&quot;}</span>
</span><span class='line'><span class="c1">;  {:sent-num 0, :token &quot;like&quot;, :pos &quot;VBP&quot;, :net &quot;O&quot;, :lemma &quot;like&quot;, :sentiment &quot;Neutral&quot;}</span>
</span><span class='line'><span class="c1">;  {:sent-num 0, :token &quot;cheese&quot;, :pos &quot;NN&quot;, :net &quot;O&quot;, :lemma &quot;cheese&quot;, :sentiment &quot;Neutral&quot;}),</span>
</span><span class='line'><span class="c1">; :refs [[{:sent-num 0, :token &quot;I&quot;, :gender &quot;UNKNOWN&quot;, :mention-type &quot;PRONOMINAL&quot;, :number &quot;SINGULAR&quot;, :animacy &quot;ANIMATE&quot;};]]}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So the text &ldquo;I like cheese&rdquo; has the following POS tags <a href="https://www.ling.upenn.edu/courses/Fall_2003/ling001/penn_treebank_pos.html">list of all POS tags</a>:</p>

<ul>
<li>I = PRP Personal Pronoun</li>
<li>like = VBP Verb, non-3rd person singular present</li>
<li>cheese &ndash; Noun, singular or mass</li>
</ul>


<p>This is great.  We have some data about the text we can analyze.  The next thing to do is to figure out how to classify the text based on this data.</p>

<h2>Classification with Weka</h2>

<p><a href="http://www.cs.waikato.ac.nz/~ml/weka/">Weka</a> is a collection of machine learning algorithms.  There is a program for interactive exploration of data sets, as well as a java library so you can use it programatically.  Speaking of data sets, we need some.  Just having one sentence about liking cheese is not going to get us very far with any machine learning.</p>

<p>So where can you go to get conversational questions and statements on the internet?  Well, one place that is pretty good for that is <a href="http://www.answers.com/Q/FAQ/2528-9">answers.com</a>.  We can scrape some pages for questions and answers.  Enough so that we can collect and cleanup some input files of</p>

<ul>
<li>~ 200 statements</li>
<li>~ 200 questions</li>
</ul>


<p>The expressives were a bit more difficult.  Let&rsquo;s just make a list of about 80 of them.</p>

<p>Now, we have a list of text data.  We need to decide on some features and generate some input files to train the classifiers on.</p>

<h3>Choosing Features for Classification</h3>

<p>First, what is a feature?  A feature is some sort of encoding of the data that the computer is going to consider for classification. For example, the number of nouns in a sentence could be a feature.  There is a whole field of study dedicated to figuring out what the best features for data for machine learning are.  Again, to keep things simple, we can take an educated guess on some features based on a good <a href="https://www.cs.utah.edu/~riloff/pdfs/emnlp11-speechacts.pdf">paper</a>:</p>

<ul>
<li>Sentence length</li>
<li>Number of nouns in the sentence (NN, NNS, NNP, NNPS)</li>
<li>If the sentence ends in a noun or adjective (NN, NNS, NNP, NNPS, JJ, JJR, JJS)</li>
<li>If the sentence begins in a verb (VB, VBD, VBG, VBP, VPZ)</li>
<li>The count of the wh, (like who, what) markers (WDT, WRB, WP, WP$)</li>
</ul>


<p>We can now go through our data file, generate our feature data, and output .arff file format to ready it as training file for weka.</p>

<p>Raw question file example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">What</span> <span class="nv">is</span> <span class="nv">floater</span> <span class="nv">exe</span>
</span><span class='line'><span class="nv">Is</span> <span class="nv">bottled</span> <span class="nv">water</span> <span class="nb">or </span><span class="nv">tap</span> <span class="nv">water</span> <span class="nv">better</span> <span class="nb">for </span><span class="nv">your</span> <span class="nv">dog</span>
</span><span class='line'><span class="nv">How</span> <span class="k">do </span><span class="nv">you</span> <span class="nv">treat</span> <span class="nv">lie</span> <span class="nv">bumps</span> <span class="nv">on</span> <span class="nv">the</span> <span class="nv">tongue</span>
</span><span class='line'><span class="nv">Can</span> <span class="nv">caffeine</span> <span class="nv">be</span> <span class="nv">used</span> <span class="nv">in</span> <span class="nv">powder</span> <span class="nv">form</span>
</span></code></pre></td></tr></table></div></figure>


<p>Arff file with features</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="err">@</span><span class="nv">relation</span> <span class="nv">speechacts</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="nv">attribute</span>       <span class="nv">sen_len</span>            <span class="nv">numeric</span>
</span><span class='line'><span class="err">@</span><span class="nv">attribute</span>       <span class="nv">nn_num</span>             <span class="nv">numeric</span>
</span><span class='line'><span class="err">@</span><span class="nv">attribute</span>       <span class="nv">end_in_n</span>           <span class="nv">numeric</span>
</span><span class='line'><span class="err">@</span><span class="nv">attribute</span>       <span class="nv">begin_v</span>            <span class="nv">numeric</span>
</span><span class='line'><span class="err">@</span><span class="nv">attribute</span>       <span class="nv">wh_num</span>             <span class="nv">numeric</span>
</span><span class='line'><span class="err">@</span><span class="nv">attribute</span>       <span class="nv">type</span>               <span class="p">{</span><span class="nv">assertion</span>,<span class="nv">question</span>,<span class="nv">expressive</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="nv">data</span>
</span><span class='line'><span class="mi">4</span>,<span class="mi">2</span>,<span class="mi">1</span>,<span class="mi">0</span>,<span class="mi">1</span>,<span class="nv">question</span>
</span><span class='line'><span class="mi">10</span>,<span class="mi">4</span>,<span class="mi">1</span>,<span class="mi">0</span>,<span class="mi">0</span>,<span class="nv">question</span>
</span><span class='line'><span class="mi">9</span>,<span class="mi">3</span>,<span class="mi">1</span>,<span class="mi">0</span>,<span class="mi">1</span>,<span class="nv">question</span>
</span><span class='line'><span class="mi">7</span>,<span class="mi">3</span>,<span class="mi">1</span>,<span class="mi">0</span>,<span class="mi">0</span>,<span class="nv">question</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that we have our input file to training our machine learning algorithms, we can start looking at classifiers.</p>

<h3>Choosing the Classifier</h3>

<p><img src="http://c2.staticflickr.com/6/5794/22338401315_1abf0ffb2d_z.jpg"></p>

<p>Using the weka explorer, we can try out different classification models.  For this data, the best one seems to be the <a href="https://en.wikipedia.org/wiki/Random_forest">Random Forest</a>.  In the explorer, it beat out Naive Bayes and J48.  It is also worth mentioning that we are not using a separate source of test data, we are cross validating on the original training set.  If we wanted to be more rigorous, we could collect more data and cut it in half, using one set for the training and one set for the testing.</p>

<p>Now that we have a classifier, we can create some Clojure code with the java library to use it.</p>

<h3>Using the Weka Classifier from our Clojure Code</h3>

<p>After importing the needed Java classes into our Clojure code, we can create the Random Forest classifier.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">classifier</span> <span class="p">(</span><span class="k">new </span><span class="nv">RandomForest</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We then create a function that will load our arff input file as a datasource</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">get-datasource</span> <span class="p">[</span><span class="nv">fname</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">new </span><span class="nv">ConverterUtils$DataSource</span>
</span><span class='line'>       <span class="p">(</span><span class="nf">.getResourceAsStream</span> <span class="p">(</span><span class="nf">clojure.lang.RT/baseLoader</span><span class="p">)</span> <span class="nv">fname</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>And another uses it to train the classifier, returning a map of the <em>evaluator</em> and <em>data</em> that we will need for our predictions.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">train-classifier</span> <span class="p">[</span><span class="nv">fname</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">source</span> <span class="p">(</span><span class="nf">get-datasource</span> <span class="nv">fname</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">data</span> <span class="p">(</span><span class="nf">.getDataSet</span> <span class="nv">source</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">_</span> <span class="p">(</span><span class="nf">.setClassIndex</span> <span class="nv">data</span> <span class="p">(</span><span class="nb">dec </span><span class="p">(</span><span class="nf">.numAttributes</span> <span class="nv">data</span><span class="p">)))</span>
</span><span class='line'>        <span class="nv">_</span>  <span class="p">(</span><span class="nf">.buildClassifier</span> <span class="nv">classifier</span> <span class="nv">data</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">e</span> <span class="p">(</span><span class="k">new </span><span class="nv">Evaluation</span> <span class="nv">data</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">.crossValidateModel</span> <span class="nv">e</span> <span class="nv">classifier</span> <span class="nv">data</span> <span class="p">(</span><span class="nf">.intValue</span> <span class="p">(</span><span class="nb">int </span><span class="mi">10</span><span class="p">))</span> <span class="p">(</span><span class="k">new </span><span class="nv">Random</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">into-array </span><span class="p">[]))</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nf">.toSummaryString</span> <span class="nv">e</span><span class="p">))</span>
</span><span class='line'>    <span class="p">{</span><span class="ss">:evaluator</span> <span class="nv">e</span>
</span><span class='line'>     <span class="ss">:data</span> <span class="nv">data</span><span class="p">}))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, we need to be able to ask about a classification for a particular instance of new data.  This is going to be where we are parsing new text and asking for an answer from our trained model.  To do this, we need to generate an <em>instance</em> for the evaluation to look at.  It is constructed from numbers in the same order as our arff file.  The exception is that we are not going to provide a value for the final field of the speech act type.  We will assign that to the a missing value.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">gen-instance</span> <span class="p">[</span><span class="nv">dataset</span> <span class="p">[</span><span class="nv">val0</span> <span class="nv">val1</span> <span class="nv">val2</span> <span class="nv">val3</span> <span class="nv">val4</span><span class="p">]]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">i</span> <span class="p">(</span><span class="k">new </span><span class="nv">Instance</span> <span class="mi">6</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">doto </span><span class="nv">i</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">.setValue</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">double </span><span class="nv">val0</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">.setValue</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">double </span><span class="nv">val1</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">.setValue</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">double </span><span class="nv">val2</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">.setValue</span> <span class="mi">3</span> <span class="p">(</span><span class="nb">double </span><span class="nv">val3</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">.setValue</span> <span class="mi">4</span> <span class="p">(</span><span class="nb">double </span><span class="nv">val4</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">.setValue</span> <span class="mi">5</span> <span class="p">(</span><span class="nf">Instance/missingValue</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">.setDataset</span> <span class="nv">dataset</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can use this function in a prediction function to get our answer back</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">predict</span> <span class="p">[</span><span class="nv">ev</span> <span class="nv">d</span> <span class="nv">vals</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">v</span>  <span class="p">(</span><span class="nf">.evaluateModelOnce</span> <span class="nv">ev</span> <span class="nv">classifier</span> <span class="p">(</span><span class="nf">gen-instance</span> <span class="nv">d</span> <span class="nv">vals</span><span class="p">))]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">case</span> <span class="nv">v</span>
</span><span class='line'>      <span class="mf">0.0</span> <span class="ss">:statement</span>
</span><span class='line'>      <span class="mf">1.0</span> <span class="ss">:question</span>
</span><span class='line'>      <span class="mf">2.0</span> <span class="ss">:expressive</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Calling the predict function would look something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">results</span> <span class="p">(</span><span class="nf">train-classifier</span> <span class="s">&quot;speech-acts-input-all.arff&quot;</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">predictor</span> <span class="p">(</span><span class="ss">:evaluator</span> <span class="nv">results</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">data</span> <span class="p">(</span><span class="ss">:data</span> <span class="nv">results</span><span class="p">))</span>
</span><span class='line'><span class="p">(</span><span class="nf">predict</span> <span class="nv">predictor</span> <span class="nv">data</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">])</span>
</span><span class='line'><span class="c1">;; -&gt; :expressive</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that we have the parsing piece and the classification piece, we can put everything together.</p>

<h3>Putting it all together</h3>

<p>We finally have all the details we need write a <code>classify-text</code> function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">classify-text</span> <span class="p">[</span><span class="nv">text</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">stats</span> <span class="p">(</span><span class="nf">parser/gen-stats</span> <span class="nv">text</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">features</span> <span class="p">[(</span><span class="ss">:sen-len</span> <span class="nv">stats</span><span class="p">)</span>
</span><span class='line'>                  <span class="p">(</span><span class="ss">:nn-num</span> <span class="nv">stats</span><span class="p">)</span>
</span><span class='line'>                  <span class="p">(</span><span class="ss">:end-in-n</span> <span class="nv">stats</span><span class="p">)</span>
</span><span class='line'>                  <span class="p">(</span><span class="ss">:begin-v</span> <span class="nv">stats</span><span class="p">)</span>
</span><span class='line'>                  <span class="p">(</span><span class="ss">:wh-num</span> <span class="nv">stats</span><span class="p">)]]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">weka/predict</span> <span class="nv">predictor</span> <span class="nv">data</span> <span class="nv">features</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">classify-text</span> <span class="s">&quot;I like cheese&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1">;; -&gt; :statement</span>
</span><span class='line'><span class="p">(</span><span class="nf">classify-text</span> <span class="s">&quot;How do you make cheese&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1">;; -&gt; :question</span>
</span><span class='line'><span class="p">(</span><span class="nf">classify-text</span> <span class="s">&quot;Right on&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1">;; -&gt; :expressive</span>
</span></code></pre></td></tr></table></div></figure>


<p>Yea! It worked.  We finally have something that will read in text and tell us its best guess of a speech act, all without punctuation.  Let&rsquo;s quickly review what we have done.</p>

<h3>Summary</h3>

<ul>
<li>Gather data sets of statements, questions, and expressives</li>
<li>Parse text and annotate it with POS tags using Stanford CoreNLP</li>
<li>Choose features of the data to analyze and generate arff files</li>
<li>Use Weka explorer to try out the best classification algorithims</li>
<li>Programatically use weka to train classifier and predict a new instance</li>
<li>Write a program to tie it all together</li>
</ul>


<p>It&rsquo;s funny how a simple thing like asking whether something is a statement or question gets you knee deep in Natural Language Processing and Machine Learning pretty fast.</p>

<p>We&rsquo;ve learned a lot, now let&rsquo;s have a bit of fun.  Now that we can classify speech acts, we can make a sort of proto chat bot with a really limited responses.</p>

<h3>Proto Chat Bot</h3>

<p>Here we are going to be a bit loose and actually check if a question mark is used.  If it is, we will automatically mark it as a question.  Otherwise, we will classify it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">respond</span> <span class="p">[</span><span class="nv">text</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">question-mark?</span> <span class="p">(</span><span class="nb">re-find </span> <span class="o">#</span><span class="s">&quot;\?$&quot;</span> <span class="nv">text</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">type</span> <span class="p">(</span><span class="k">if </span><span class="nv">question-mark?</span>
</span><span class='line'>               <span class="ss">:question</span>
</span><span class='line'>               <span class="p">(</span><span class="nf">classify-text</span> <span class="nv">text</span><span class="p">))]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">case</span> <span class="nv">type</span>
</span><span class='line'>      <span class="ss">:question</span> <span class="s">&quot;That is an interesting question.&quot;</span>
</span><span class='line'>      <span class="ss">:statement</span> <span class="s">&quot;Nice to know.&quot;</span>
</span><span class='line'>      <span class="ss">:expressive</span> <span class="s">&quot;:)&quot;</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We just need a quick repl and main function now:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">repl</span> <span class="p">[]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">do</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">print </span><span class="s">&quot;&gt;&gt; &quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">flush</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">input</span> <span class="p">(</span><span class="nf">read-line</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">if-not </span><span class="p">(</span><span class="nb">= </span><span class="nv">input</span> <span class="s">&quot;quit&quot;</span><span class="p">)</span>
</span><span class='line'>     <span class="p">(</span><span class="nf">do</span>
</span><span class='line'>       <span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nf">try</span> <span class="p">(</span><span class="nf">c/respond</span> <span class="nv">input</span><span class="p">)</span>
</span><span class='line'>                     <span class="p">(</span><span class="nf">catch</span> <span class="nv">Exception</span> <span class="nv">e</span> <span class="p">(</span><span class="nb">str </span><span class="s">&quot;Sorry: &quot;</span> <span class="nv">e</span> <span class="s">&quot; - &quot;</span> <span class="p">(</span><span class="nf">.getMessage</span> <span class="nv">e</span><span class="p">)))))</span>
</span><span class='line'>       <span class="p">(</span><span class="nf">recur</span><span class="p">))</span>
</span><span class='line'>     <span class="p">(</span><span class="k">do </span><span class="p">(</span><span class="nb">println </span><span class="s">&quot;Bye!&quot;</span><span class="p">)</span>
</span><span class='line'>         <span class="p">(</span><span class="nf">System/exit</span> <span class="mi">0</span><span class="p">)))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">-main</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Hello.  Let&#39;s chat.&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">flush</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">repl</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Testing it out with <code>lein run</code>, we can have a little chat:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">Hello.</span>  <span class="nv">Let</span><span class="ss">&#39;s</span> <span class="nv">chat.</span>
</span><span class='line'><span class="nv">&gt;&gt;</span> <span class="nv">Hi</span>
</span><span class='line'><span class="err">:</span><span class="p">)</span>
</span><span class='line'><span class="nv">&gt;&gt;</span> <span class="nv">Do</span> <span class="nv">you</span> <span class="nv">know</span> <span class="nv">where</span> <span class="nv">I</span> <span class="nv">can</span> <span class="nv">go</span> <span class="nv">to</span> <span class="nv">buy</span> <span class="nv">cheese</span>
</span><span class='line'><span class="nv">That</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">interesting</span> <span class="nv">question.</span>
</span><span class='line'><span class="nv">&gt;&gt;</span> <span class="nv">I</span> <span class="nv">am</span> <span class="nv">a</span> <span class="nv">big</span> <span class="nv">cheese</span> <span class="nv">fan</span>
</span><span class='line'><span class="nv">Nice</span> <span class="nv">to</span> <span class="nv">know.</span>
</span><span class='line'><span class="nv">&gt;&gt;</span> <span class="nv">you</span> <span class="nv">are</span> <span class="nv">quite</span> <span class="nv">smart</span>
</span><span class='line'><span class="nv">Nice</span> <span class="nv">to</span> <span class="nv">know.</span>
</span><span class='line'><span class="nv">&gt;&gt;</span> <span class="nv">bye</span>
</span><span class='line'><span class="err">:</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Want more?  Check out the code <a href="https://github.com/gigasquid/speech-acts-classifier">https://github.com/gigasquid/speech-acts-classifier</a>.</p>

<p><em>Special thanks to <a href="https://twitter.com/ohpauleez">Paul deGrandis</a> for allowing me to pick his awesome brain on AI things</em></p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2015/10/20/speech-act-classification-for-text-with-clojure//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/08/25/converstations-with-datomic-3/">
		
			Conversations With Datomic - Part 3</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2015-08-25T10:28:00-04:00" pubdate data-updated="true">Aug 25<span>th</span>, 2015</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>, <a class='category' href='/blog/categories/clojure/'>Clojure</a>, <a class='category' href='/blog/categories/datomic/'>Datomic</a>


</div>
    </div>
		<p><img src="https://avatars0.githubusercontent.com/u/1478702?v=3&s=200"></p>

<p><em>This is a continuation of the <a href="http://gigasquidsoftware.com/blog/2015/08/15/conversations-with-datomic/">first</a> and
<a href="http://gigasquidsoftware.com/blog/2015/08/19/conversations-with-datomic-part-2/">second</a> conversations in which topics such as creating databases,
learning facts, querying, and time traveling were discussed.  Today&rsquo;s topics include architecture, caching, and scaling.</em></p>

<p><strong>Human:</strong>  Hello again <a href="http://www.datomic.com/">Datomic</a>. Ready to talk again?</p>

<p><strong>Datomic:</strong> Sure.  I think you wanted to ask me some questions about how I would fit in with your other systems.</p>

<p><strong>Human:</strong> Yes.  Like I was saying earlier, I think your abilities to learn facts, reason about them, and keep track of the history of all those facts is really great.
I am interested in having you work with me every day, but first I want to understand your components so that I can make sure you are a good fit for us.</p>

<p><strong>Datomic:</strong> I would be happy to explain my architecture to you.  Perhaps showing you this picture is the best way to start.</p>

<p><img src="http://c2.staticflickr.com/6/5723/20819693686_f9ec3852c3_z.jpg"></p>

<p>I am made of three main parts: my <em>transactors</em>, my <em>peers</em>, and my <em>storage</em>.</p>

<p><strong>Human</strong>:  What is a <em>peer</em>?</p>

<p><strong>Datomic</strong>:  A <em>peer</em> is an application that is using the peer library.  In our last conversations,  we were talking through the Clojure api with <code>datomic.api</code>.  The application, or process, that is running this api is called a peer.  There can be many of these, all having conversations with me.</p>

<p><strong>Human</strong>: The peers then talk to your <em>transactor</em>?</p>

<p><strong>Datomic</strong> Yes. The peers talk to my transactor whenever you call <code>transact</code> with the peer library.  It is the central coordinator between all the peers and processes the requests using <em>ACID</em> transactions, and then sends the facts off to storage.</p>

<p><strong>Human:</strong>  Could you remind me what <em>ACID</em> stands for again?  I always forget.  The first one is <em>Atomic</em> right?</p>

<p><strong>Datomic:</strong> That is right.  I am <em>Atomic</em> in that every transaction you send to me is all or nothing.  If for some reason, one part of it fails, I will reject the entire transaction and leave my database unchanged.</p>

<p>The C is for <em>Consistency</em>.  This means that I provide every peer with a consistent view of facts over time and transactions.  I provide a global ordering of transactions across all the peers with my transactor and peers will always see all the transactions up to their current time without any gaps.</p>

<p><strong>Human:</strong> What if a peer is behind the global time?  How do they catch up to know about the new facts that were transacted by a different peer?</p>

<p><strong>Datomic:</strong> After one peer sends me a successful transaction with some new facts, I will notify all the peers about them.</p>

<p><strong>Human:</strong> Cool. That takes care of the A and C in ACID. What about the I?</p>

<p><strong>Datomic:</strong> It stands for Isolated.  It makes sure that even through there are many peers having conversations with me, transactions are executed serially.  This happens naturally with my transactor.  Since there is only one transactor, transactions are always executed serially.</p>

<p><strong>Human</strong>:  In the picture, why are there are two transactors then?</p>

<p><strong>Datomic</strong>:  Oh, that is for High Availability.  When I startup my system, I can launch two running transactors, but hold one in reserve.  Just on the off chance something happens to the main one, I will swap in the failover one to keep things running smoothly.</p>

<p>The final D in <em>ACID</em> is for Durability.  Once a transaction has been committed by my transactor, it is shipped off to storage for safe keeping.</p>

<p><strong>Human:</strong> What exactly is this storage?</p>

<p><strong>Datomic:</strong> Instead of storing datoms, I send <em>segments</em>, which are closely related datoms,  to storage.  I have quite a few options for storage:</p>

<ul>
<li>Dev mode &ndash; which just runs within my transactor and writes to the local file system.</li>
<li>SQL database</li>
<li>DynamoDB</li>
<li>Cassandra</li>
<li>Riak</li>
<li>Couchbase</li>
<li>Infinispan memory cluster</li>
</ul>


<p><strong>Human:</strong> Which one is the best to use?</p>

<p><strong>Datomic:</strong> <em>The best one to use is the one that you are already have in place at work</em>.  This way, I can integrate seamlessly with your other systems.</p>

<p><strong>Human:</strong> Oh, we didn&rsquo;t really talk about caching.  Can you explain how you do that?</p>

<p><strong>Datomic:</strong> Certainly.  It is even worth another picture.</p>

<p><img src="http://c2.staticflickr.com/6/5630/20852217305_90506481fe.jpg"></p>

<p>Each peer has a its own <em>working set</em> of recent datoms along with a index to all the rest of the datoms in storage in memory.  When the peer has a query for a datom, it first checks to see if it has it locally in its memory cache.  If it can&rsquo;t find it there, then it will ask for a segment of that datom from storage.  Storage will return that datom along with other related datoms in that segment so that the peer can cache that in memory to make it faster for the next query.</p>

<p><strong>Human:</strong> That seems really different from other databases, where the client constantly requests queries from a server.</p>

<p><strong>Datomic:</strong> Yes.  When most questions can be answered from the local memory, responses are really fast.  You don&rsquo;t need to hit storage unless you really need too.  You can even add an extra layer of caching with memcached.</p>

<p><strong>Human:</strong> That sounds great.  I can&rsquo;t wait tell you about all of our data.  We talked a bit about your querying ability earlier, can you do the same queries that our other standard relational databases do, like joins?</p>

<p><strong>Datomic:</strong> Oh yes.  In fact, with me, you don&rsquo;t need to specify your joins explicitly.  I use <em>Datalog</em>, which is based on logic, so my joins are implicit.  I will figure out exactly what I need to put together to answer your query without you having to spell it out for me.</p>

<p><strong>Human:</strong> Ok.  I know that I can map some of my data that is already in other database tables to you.  What about other types of irregular data, like graphs, or sparse data.</p>

<p><strong>Datomic:</strong> I am actually very proud of my data model.  It is extremely flexible.  Since I store things on such a granular datom level, you don&rsquo;t need to map your logical data model to my physical model.  I can handle <em>rectangular</em> table shaped data quite happily along with graph data, sparse data, or other <em>non-rectangular</em> data.</p>

<p><strong>Human:</strong> That sounds great.  What do I need to know about your scaling?</p>

<p><strong>Datomic:</strong> I really excel at reads.  All you have to do is elastically add another peer to me for querying.  I am not really a good fit for write scale, like big data, or log file analysis.  You will find me most happy with data that is valuable information of record and has history that is important, like transaction, medical, or inventory data.  I am also really good at being flexible for development and operations since I can use many different types of storage.  I have worked with many web and cloud apps.</p>

<p><strong>Human:</strong> Thanks for answering all my questions.  I think you might fit in quite well with our other systems.</p>

<p><strong>Datomic:</strong> Great!</p>

<p><strong>Human:</strong> One more thing, this conversation has been great, but do you have any training resources for me and my other human coworkers?</p>

<p><strong>Datomic:</strong> Sure thing. There are a few really good resources on the <a href="http://www.datomic.com/training.html">Datomic Training Site</a>.  I would suggest watching the videos there and pairing them with:</p>

<ul>
<li><a href="https://github.com/stuarthalloway/presentations/blob/master/Nov2014/DayOfDatomicNov2014.pdf?raw=true">The slides for the videos</a> which have the labs to work through form the videos.</li>
<li><a href="https://github.com/Datomic/day-of-datomic">The Day of Datomic Repo</a> which has lots of great examples to play with.</li>
<li><a href="http://docs.datomic.com/">Tne Datomic Development Resources</a>, which include the docs on the <a href="http://docs.datomic.com/clojure/index.html">Clojure API</a></li>
</ul>


<p>Also, if you want to confirm that your data is good fit for me, I suggest you describe your data to the <a href="https://groups.google.com/forum/#!forum/datomic">Datomic Google Group</a>.  They are nice and knowledgeable group of humans.</p>

<p><strong>Human:</strong> Thanks again Datomic!  I will grab another cookie and check it out!</p>

<p><strong>Datomic:</strong> What is it with humans and cookies?&hellip;</p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2015/08/25/converstations-with-datomic-3//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/08/19/conversations-with-datomic-part-2/">
		
			Conversations With Datomic Part 2</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2015-08-19T08:56:00-04:00" pubdate data-updated="true">Aug 19<span>th</span>, 2015</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/all/'>All</a>, <a class='category' href='/blog/categories/clojure/'>Clojure</a>, <a class='category' href='/blog/categories/datomic/'>Datomic</a>


</div>
    </div>
		<p><img src="https://avatars0.githubusercontent.com/u/1478702?v=3&s=200"></p>

<p><em>The following is a continuation of the first <a href="http://gigasquidsoftware.com/blog/2015/08/15/conversations-with-datomic/">conversation</a> which touched on schema creation and querying.  This conversation includes learning new facts, time, and the sometimes unfortunate reality of lawyers.</em></p>

<p><strong>Human:</strong>  Hi <a href="http://www.datomic.com/">Datomic</a>.  I am back from my tea and cookies break.  I really enjoyed talking with you, could we continue our conversation?</p>

<p><strong>Datomic:</strong> Certainly.  Let me see, where did we leave off?</p>

<p><strong>Human:</strong> Let me check my <a href="https://gist.github.com/gigasquid/92a1effb14fe4f6ced59">notes</a>.  Oh yes, we had created a database and filled it with facts about some dogs and owners.  You showed me how to ask you things about the facts, like which dogs liked cheese.</p>

<p><strong>Datomic:</strong> Ah yes.  We were just getting to the really interesting part about how I learn new facts without forgetting the past ones.</p>

<p><strong>Human:</strong> Can you please explain a bit more about how you learn new facts?</p>

<p><strong>Datomic:</strong> Sure.  I learn facts when you tell me to <em>add</em> a new fact about some entity, or to <em>retract</em> a fact about it.  It will probably make more sense with an example.  Let&rsquo;s take the dog with the name &ldquo;Tiny&rdquo; that I know about.  Could you please ask me about the dog and all of the attributes?</p>

<p><strong>Human:</strong> Alright.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/pull</span> <span class="p">(</span><span class="nf">d/db</span> <span class="nv">conn</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">*</span><span class="p">]</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:db/id</span> <span class="mi">17592186045423</span>
</span><span class='line'> <span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span>
</span><span class='line'> <span class="ss">:dog/breed</span> <span class="s">&quot;Great Dane&quot;</span>
</span><span class='line'> <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Cheese&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>There is an entity (dog) with the name &ldquo;Tiny&rdquo; who is a Great Dane and his favorite-treat is Cheese.  I am not really sure why the Cheese is capitalized, but I am sure it makes sense to a human.</p>

<p><strong>Human:</strong> Oh right.  Well, now that you mention it, I am not really sure about the cheese thing either. Can I just remove that fact?</p>

<p><strong>Datomic:</strong> Well, you can tell me to <em>retract</em> that fact by sending me a transaction in the form of <code>[:db/retract entity-id attribute value]</code>.  In the case of the dog, since the name attribute is unique, you can just give me the selector for Tiny like this <code>[:dog/name "Tiny"]</code>.</p>

<p><strong>Human:</strong> Like this?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/transact</span> <span class="nv">conn</span> <span class="p">[[</span><span class="ss">:db/retract</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">]</span> <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Cheese&quot;</span><span class="p">]])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong> Exactly.  I have retracted that fact about &ldquo;Tiny&rdquo;.  Go ahead and ask me about all of Tiny&rsquo;s attributes again.</p>

<p><strong>Human:</strong>  Ok.  I use <code>(d/db conn)</code> for the current database value right?</p>

<p><strong>Datomic:</strong> Yes. But if you are going to be asking me multiple questions about this database value, you should not repeat the <code>(d/db conn)</code> all the time.</p>

<p><strong>Human:</strong> Oh. What should I do instead?</p>

<p><strong>Datomic:</strong> The connection with me is like a ref.  Just like other refs, you should deref it once to get the database value and then use the value repeatedly. This single database value will provide consistency for all your queries.</p>

<p><strong>Human:</strong> That makes sense.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">db-tiny-no-cheese</span> <span class="p">(</span><span class="nf">d/db</span> <span class="nv">conn</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">d/pull</span> <span class="nv">db-tiny-no-cheese</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">*</span><span class="p">]</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:db/id</span> <span class="mi">17592186045423</span>, <span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span>, <span class="ss">:dog/breed</span> <span class="s">&quot;Great Dane&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Tiny is a Great Dane.</p>

<p><strong>Human:</strong> So you don&rsquo;t know anything about the <code>:dog/favorite-treat</code> for &ldquo;Tiny&rdquo;?</p>

<p><strong>Datomic:</strong> At this particular time, I do not have anything to assert about the favorite-treat of Tiny.  However, I still remember everything about all the facts that you have told me.  For each transaction that you send me, I have a notion of a point in time like <em>t0</em>, <em>t1</em>, <em>t2</em>.  I have a complete database value for each one of those points in time.  In fact, you can look at <em>all</em> of my assertions and retractions that I have learned about using the <code>d/history</code> function on the database value.  This asks me to expose my history, which is normally hidden in favor of the <em>present</em>. I will return back a special database containing all the assertions and retractions across time.  Any queries that you ask me will have a fifth <em>datom</em> field to help you distinguish the difference.</p>

<p><strong>Human:</strong>  A fifth datom field?</p>

<p><strong>Datomic:</strong> A <em>datom</em> consists of the following parts: the entity, the attribute, the value, transaction, and an operation which tells you if the fact was added or retracted (e a v tx op).  Why don&rsquo;t you try using the <code>d/history</code> function to ask me about all the facts having to do with Tiny?  I suggest using the datalog query</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="o">&#39;</span><span class="p">[</span><span class="ss">:find</span> <span class="nv">?e</span> <span class="nv">?a</span> <span class="nv">?v</span> <span class="nv">?tx</span> <span class="nv">?op</span>
</span><span class='line'>  <span class="ss">:in</span> <span class="nv">$</span>
</span><span class='line'>  <span class="ss">:where</span> <span class="p">[</span><span class="nv">?e</span> <span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">]</span>
</span><span class='line'>         <span class="p">[</span><span class="nv">?e</span> <span class="nv">?a</span> <span class="nv">?v</span> <span class="nv">?tx</span> <span class="nv">?op</span><span class="p">]]</span>
</span></code></pre></td></tr></table></div></figure>


<p>which will return all the entity, attribute, value, transaction, and operation facts I ever knew about Tiny.</p>

<p><strong>Human:</strong> Ok.  Here goes.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/q</span> <span class="o">&#39;</span><span class="p">[</span><span class="ss">:find</span> <span class="nv">?e</span> <span class="nv">?a</span> <span class="nv">?v</span> <span class="nv">?tx</span> <span class="nv">?op</span>
</span><span class='line'>       <span class="ss">:in</span> <span class="nv">$</span>
</span><span class='line'>       <span class="ss">:where</span> <span class="p">[</span><span class="nv">?e</span> <span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">]</span>
</span><span class='line'>       <span class="p">[</span><span class="nv">?e</span> <span class="nv">?a</span> <span class="nv">?v</span> <span class="nv">?tx</span> <span class="nv">?op</span><span class="p">]]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">d/history</span> <span class="nv">db-tiny-no-cheese</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="o">#</span><span class="p">{[</span><span class="mi">17592186045423</span> <span class="mi">63</span> <span class="s">&quot;Tiny&quot;</span>       <span class="mi">13194139534314</span> <span class="nv">true</span><span class="p">]</span>
</span><span class='line'>  <span class="p">[</span><span class="mi">17592186045423</span> <span class="mi">64</span> <span class="s">&quot;Great Dane&quot;</span> <span class="mi">13194139534314</span> <span class="nv">true</span><span class="p">]</span>
</span><span class='line'>  <span class="p">[</span><span class="mi">17592186045423</span> <span class="mi">65</span> <span class="s">&quot;Cheese&quot;</span>     <span class="mi">13194139534314</span> <span class="nv">true</span><span class="p">]</span>
</span><span class='line'>  <span class="p">[</span><span class="mi">17592186045423</span> <span class="mi">65</span> <span class="s">&quot;Cheese&quot;</span>     <span class="mi">13194139534320</span> <span class="nv">false</span><span class="p">]}</span>
</span></code></pre></td></tr></table></div></figure>


<p>During one transaction, you told me to add three facts about an entity:</p>

<ul>
<li>The <code>:dog/name</code> attribute, (which I refer to as 63), has the value of &ldquo;Tiny&rdquo;.</li>
<li>The <code>:dog/breed</code> attribute, (which I refer to as 64), has the value of &ldquo;Great Dane&rdquo;.</li>
<li>The <code>:dog/favorite-treat</code> attribute, (which I refer to as 65), has the value of &ldquo;Cheese&rdquo;.</li>
</ul>


<p>During another transaction, you told me to retract a fact regarding the attribute <code>:dog/favorite-treat</code> about the same entity.</p>

<p><strong>Human:</strong> Wow, that is really cool.  Is there a way that I can <em>travel back in time</em> to see the world as it was during that first transaction?</p>

<p><strong>Datomic:</strong> Yes.  I am practically a Tardis.  You can use the <code>d/as-of</code> function with a database value and the transaction number and you can time travel.  Using that <em>time traveled</em> database value, you can ask me about all the facts I knew as of that time.</p>

<p><strong>Human:</strong> I can&rsquo;t wait to try this.  Ok, let&rsquo;s go back to the time when I first asserted the fact that Tiny liked cheese.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/pull</span> <span class="p">(</span><span class="nf">d/as-of</span> <span class="nv">db-tiny-no-cheese</span> <span class="mi">13194139534314</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">*</span><span class="p">]</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong>  Hold on.  We are time traveling!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:db/id</span> <span class="mi">17592186045423</span>
</span><span class='line'> <span class="ss">:dog/name</span> <span class="s">&quot;Tiny&quot;</span>
</span><span class='line'> <span class="ss">:dog/breed</span> <span class="s">&quot;Great Dane&quot;</span>
</span><span class='line'> <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Cheese&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Tiny is a Great Dane whose favorite treat is Cheese.</p>

<p><strong>Human:</strong> Fantastic! Let&rsquo;s go back to the future now, ummm I mean present. Time is a bit wibbly wobbly.</p>

<p><strong>Datomic:</strong> Just take the <code>as-of</code> function off of the database value and you will be back in the <em>present</em>.</p>

<p><strong>Human:</strong> Hmmm&hellip; Do I have to do a <em>retract</em> every time I want to change a value?  For example, the dog named Fido has a favorite treat of a Bone right now, right?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/pull</span> <span class="nv">db-tiny-no-cheese</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">*</span><span class="p">]</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Fido&quot;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:db/id</span> <span class="mi">17592186045421</span>
</span><span class='line'> <span class="ss">:dog/name</span> <span class="s">&quot;Fido&quot;</span>
</span><span class='line'> <span class="ss">:dog/breed</span> <span class="s">&quot;Mix&quot;</span>
</span><span class='line'> <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Bone&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Yes, it is a &ldquo;Bone&rdquo;.</p>

<p><strong>Human:</strong> So, if I want to change it to be &ldquo;Eggs&rdquo;,  do I need to retract the current value of &ldquo;Bone&rdquo; first and then add the fact of &ldquo;Eggs&rdquo;?</p>

<p><strong>Datomic:</strong> You certainly could do that and I would understand you perfectly.  However, if you simply assert a new value for an existing attribute, I will automatically add the retraction for you.</p>

<p><strong>Human:</strong> Cool.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">d/transact</span> <span class="nv">conn</span> <span class="p">[{</span><span class="ss">:db/id</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Fido&quot;</span><span class="p">]</span>
</span><span class='line'>                   <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Eggs&quot;</span><span class="p">}])</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">d/pull</span> <span class="p">(</span><span class="nf">d/db</span> <span class="nv">conn</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">*</span><span class="p">]</span> <span class="p">[</span><span class="ss">:dog/name</span> <span class="s">&quot;Fido&quot;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Datomic</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:db/id</span> <span class="mi">17592186045421</span>
</span><span class='line'> <span class="ss">:dog/name</span> <span class="s">&quot;Fido&quot;</span>
</span><span class='line'> <span class="ss">:dog/breed</span> <span class="s">&quot;Mix&quot;</span>
</span><span class='line'> <span class="ss">:dog/favorite-treat</span> <span class="s">&quot;Eggs&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Fido now has a favorite-treat of &ldquo;Eggs&rdquo;.</p>

<p><strong>Human:</strong> This is really neat.  You <em>never</em> forget any facts?</p>

<p><strong>Datomic:</strong> Nope. Well, except in really exceptional circumstances that usually involve lawyers.</p>

<p><strong>Human:</strong> Lawyers?</p>

<p><strong>Datomic:</strong> Sigh.  Yes, well in some unique situations, you might be under a legal obligation to really <em>forget</em> certain facts and totally remove them from the database. There is a special tool that you can use to <em>excise</em> the data.  However, I will store a fact that <em>something</em> was deleted at that time. I just won&rsquo;t be able to remember <em>what</em>.</p>

<p><strong>Human:</strong> That doesn&rsquo;t sound fun.</p>

<p><strong>Datomic:</strong> I prefer to keep all my facts intact.</p>

<p><strong>Human:</strong> I can definitely see that. Well, on a happier subject, I have been very impressed with you during our conversations.  Having a time traveling database that can reason about facts seems like a really useful thing.  Also, you are also really nice.</p>

<p><strong>Datomic:</strong> Awww shucks, thanks.  For a human, you are really nice too.</p>

<p><strong>Human:</strong> I was thinking about the possibility of you coming and working with me every day. Would you mind chatting some more to me about your architecture?  I want to understand how your would fit with our other systems.</p>

<p><strong>Datomic:</strong> Certainly. I would love that.  Do you want to talk about it now, or have another cookie break first?</p>

<p><strong>Human:</strong> Now that you mention cookies&hellip; Let&rsquo;s take a short break and we will talk again soon.</p>

<p><em>(P.S. Humans, there are some great <a href="http://www.datomic.com/training.html">Datomic Training Videos</a> if you want to learn more)</em></p>

		
		
	</div>

<div class="meta">
	
		<span class="comments"><a href="/blog/2015/08/19/conversations-with-datomic-part-2//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>

    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2016

    Carin Meier
. Powered by <a href="http://octopress.org">Octopress</a> | 
    Theme <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'squidsblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
